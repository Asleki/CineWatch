<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CineWatch - Cinema Guide</title>
  
  <!-- Font Awesome CDN for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Inter Font (for consistent typography across the site) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /*
     * File: cinema_guide.css (Embedded Styles)
     * Description: Styles for the cinema guide page, including loading screen,
     * hero section, city filter, cinema listings, and multi-step booking modal.
     */


    /* Root Theme Variables */
    :root {
      --bg: #fff;
      --text: #111;
      --header-bg: #f0ecec;
      --search-bg: #f4f4f4;
      --highlight: rgb(28, 12, 241); /* Blue used for highlight */
      --danger: #f44336;
      --cinewatch-blue: #000080; /* Dark blue color for CineWatch name */

      /* Variables for custom message box & dropdown in light mode */
      --message-box-bg: #fff;
      --message-box-text: #111;
      --message-box-border: #ccc;
      --message-box-button-bg: #007bff;
      --message-box-button-text: white;
      --message-box-button-hover-bg: #0056b3;

      --dropdown-bg: #fff;
      --dropdown-item-hover-bg: #f0f0f0;
      --dropdown-border: #ddd;

      /* Specific for carousel */
      --carousel-bg: #f0f0f0;
      --card-bg: #ffffff;
      --card-border: #e0e0e0;
      --card-shadow: rgba(0, 0, 0, 0.1);
      --play-icon-color: rgba(255, 255, 255, 0.8);
      --play-icon-hover-color: rgba(255, 255, 255, 1);

      
      /* Additional variables for the new footer */
      --primary-color: #0056b3; /* A vibrant blue for main accents and headings */
      --secondary-color: #007bff; /* A slightly lighter blue for links and secondary actions */
      --accent-color: #f39c12; /* Orange for highlights and call-to-action elements */
      --text-color-light: #2C3E50; /* Dark, almost black blue-gray for readability */
      --background-color-light: #F0F8FF; /* Alice Blue - very light, airy blue */
      --section-bg-light: #E6F7FF; /* Pale blue for section backgrounds */
      --border-color-light: #A0D9EF; /* Medium blue for borders */
      --shadow-color-light: rgba(70, 130, 180, 0.2); /* Steel blue with transparency for subtle shadow */
      --header-bg-light: #C9EEFF; /* Light Cyan-like blue for headers */

      /* Footer specific grey colors */
      --footer-bg-light-grey: #e0e0e0; /* Light grey for footer in light mode */
      --footer-bg-dark-grey: #333333; /* Darker grey for footer in dark mode */
    }

    /* Dark Mode Theme Variables */
    body.dark-mode {
      --bg: #1a1a1a;
      --text: #f0f0f0;
      --header-bg: #2a2a2a;
      --search-bg: #3a3a3a;
      --highlight: #6699ff; /* Lighter blue for dark mode highlight */
      --danger: #ff6b6b;
      --cinewatch-blue: #ADD8E6; /* Light blue for CineWatch name in dark mode */

      /* Variables for custom message box & dropdown in dark mode */
      --message-box-bg: #333;
      --message-box-text: #f0f0f0;
      --message-box-border: #555;
      --message-box-button-bg: #6699ff;
      --message-box-button-text: #111;
      --message-box-button-hover-bg: #4477ee;

      --dropdown-bg: #333;
      --dropdown-item-hover-bg: #444;
      --dropdown-border: #555;

      /* Specific for carousel in dark mode */
      --carousel-bg: #2a2a2a;
      --card-bg: #3a3a3a;
      --card-border: #444;
      --card-shadow: rgba(0, 0, 0, 0.3);
    }


    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      color: var(--text);
      background-color: var(--bg);
      transition: background-color 0.3s ease, color 0.3s ease;
      overflow-x: hidden; /* Prevent horizontal scroll */
    }

    a {
      color: var(--highlight);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    img {
        max-width: 100%;
        height: auto;
        display: block; /* Removes extra space below image */
    }

    /* --- Initial Loading Screen --- */
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
      opacity: 1;
      visibility: visible;
    }

    #loadingScreen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-text {
      font-size: 2rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
    }

    .loading-dots span {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin: 0 5px;
      background-color: var(--highlight);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    .loading-dots span:nth-child(3) { animation-delay: 0s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* --- Header --- */
    #utilityHeader {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--header-bg);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transition: background-color 0.3s ease;
    }

    #utilityHeader .logo {
      font-weight: 700;
      font-size: 1.8rem;
    }

    #utilityHeader .logo a {
      color: var(--cinewatch-blue);
      text-decoration: none;
    }

    .header-icons {
      display: flex;
      gap: 20px;
    }

    .header-icons i {
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text);
      transition: color 0.2s ease, transform 0.2s ease;
    }

    .header-icons i:hover {
      color: var(--highlight);
      transform: scale(1.1);
    }

    /* --- Search Subheader --- */
    .search-subheader {
      position: absolute;
      top: 60px; /* Below the header */
      right: 0; /* Start from the right */
      width: 100%;
      max-width: 500px; /* Limit width to give animation space */
      background-color: var(--search-bg);
      padding: 10px 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      z-index: 999; /* Below header, above main content */
      transform: translateX(100%); /* Start hidden off-screen to the right */
      transition: transform 0.3s ease-in-out;
      display: flex; /* Use flex for layout */
      flex-direction: column; /* Stack input and suggestions */
      gap: 10px;
      border-bottom-left-radius: 8px;
      border-bottom-right-radius: 8px;
    }

    .search-subheader.visible {
      transform: translateX(0); /* Slide in from the right */
    }

    .search-bar-container {
      display: flex;
      align-items: center;
      width: 100%;
      border: 1px solid var(--dropdown-border);
      border-radius: 20px;
      background-color: var(--bg);
      padding: 5px 15px;
    }

    #searchInput {
      flex-grow: 1;
      border: none;
      padding: 8px;
      font-size: 1rem;
      background-color: transparent;
      color: var(--text);
      outline: none;
    }

    #searchInput::placeholder {
      color: var(--text); /* Adjust placeholder color */
      opacity: 0.7;
    }

    .clear-search-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      padding: 5px;
      transition: color 0.2s ease;
    }

    .clear-search-btn:hover {
      color: var(--danger);
    }

    .suggestions-box {
      width: calc(100% - 40px); /* Adjust for padding of search-subheader */
      background-color: var(--dropdown-bg);
      border: 1px solid var(--dropdown-border);
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative; /* Relative to search-subheader */
      left: 0;
      top: 0;
      display: none; /* Hidden by default */
    }

    .suggestions-box.visible {
      display: block;
    }

    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      color: var(--text);
      border-bottom: 1px solid var(--dropdown-border);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-item:hover {
      background-color: var(--dropdown-item-hover-bg);
    }

    .suggestion-item.primary-suggestion {
      font-weight: 500;
      color: var(--highlight);
    }


    /* --- Account Dropdown --- */
    .account-dropdown {
      position: absolute;
      top: 60px; /* Below header */
      right: 20px;
      background-color: var(--dropdown-bg);
      border: 1px solid var(--dropdown-border);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: none; /* Hidden by default */
      flex-direction: column;
      min-width: 180px; /* Increased min-width for new links */
      padding: 10px 0;
      z-index: 1000;
    }

    .account-dropdown.visible {
      display: flex;
    }

    .account-dropdown a {
      padding: 10px 15px;
      color: var(--text);
      text-decoration: none;
      white-space: nowrap;
      transition: background-color 0.2s ease;
      display: flex; /* For icons */
      align-items: center; /* For icons */
    }

    .account-dropdown a i {
        margin-right: 10px; /* Space between icon and text */
    }

    .account-dropdown a:hover {
      background-color: var(--dropdown-item-hover-bg);
      text-decoration: none;
    }

    .account-dropdown .logout-item {
        color: var(--danger);
        border-top: 1px solid var(--dropdown-border);
        margin-top: 5px;
        padding-top: 10px;
    }

    .account-dropdown .logout-item:hover {
        background-color: var(--danger);
        color: white;
    }


    /* --- Main Subheader with Tagline and Nav --- */
    .main-subheader {
        background-color: var(--header-bg);
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 990; /* Below search subheader, above main content */
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
    }

    .site-tagline {
        font-size: 1.1rem;
        color: var(--text);
        font-weight: 500;
        margin: 5px 0;
    }

    .main-nav ul {
        list-style: none;
        display: flex;
        gap: 25px;
    }

    .main-nav a {
        color: var(--cinewatch-blue);
        font-weight: 600;
        font-size: 1rem;
        transition: color 0.2s ease, text-decoration 0.2s ease;
        white-space: nowrap; /* Prevent nav items from wrapping */
    }

    .main-nav a:hover {
        color: var(--highlight);
        text-decoration: underline;
    }


    /* --- Mobile Navigation Overlay --- */
    .mobile-nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1001;
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0.3s ease, opacity 0.3s ease;
    }

    .mobile-nav-overlay.show {
      visibility: visible;
      opacity: 1;
    }

    .mobile-nav-content {
      background-color: var(--bg);
      padding: 30px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      position: relative;
      width: 80%; /* Adjust for mobile screen */
      max-width: 300px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .mobile-nav-content .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.5rem;
      color: var(--text);
      cursor: pointer;
    }

    .mobile-nav-content a {
      color: var(--text);
      font-size: 1.2rem;
      font-weight: 500;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      transition: background-color 0.2s ease, color 0.2s ease;
      display: flex; /* For icons */
      align-items: center; /* For icons */
      justify-content: center; /* Center text and icon */
    }
    .mobile-nav-content a i {
        margin-right: 10px;
    }

    .mobile-nav-content a:hover,
    .mobile-nav-content a.active {
      background-color: var(--highlight);
      color: white;
      text-decoration: none;
    }

    .mobile-login-btn, .mobile-logout-btn {
      margin-top: 20px;
      background-color: var(--cinewatch-blue);
      color: white;
      font-weight: bold;
    }

    .mobile-login-btn:hover, .mobile-logout-btn:hover {
        background-color: var(--highlight);
    }

    /* --- Custom Alert/Message Box --- */
    .custom-alert-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0.3s ease, opacity 0.3s ease;
    }

    .custom-alert-overlay.show {
      visibility: visible;
      opacity: 1;
    }

    .alert-content {
      background-color: var(--message-box-bg);
      color: var(--message-box-text);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      max-width: 400px;
      width: 90%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      border: 1px solid var(--message-box-border);
    }

    .alert-icon {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    /* Icon Colors */
    .blue-icon { color: var(--highlight); }
    .green-icon { color: #28a745; }
    .red-icon { color: var(--danger); }
    .orange-icon { color: #ffc107; }

    #alertMessage {
      font-size: 1.1rem;
      margin-bottom: 15px;
      word-wrap: break-word;
    }

    .close-alert-btn {
      background-color: var(--message-box-button-bg);
      color: var(--message-box-button-text);
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }

    .close-alert-btn:hover {
      background-color: var(--message-box-button-hover-bg);
      transform: translateY(-1px);
    }

    /* Footer Styles */
    .site-footer {
        background-color: var(--footer-bg-light-grey); /* Changed to light grey */
        color: var(--text-color-light);
        padding: 2rem 0;
        margin-top: auto;
        box-shadow: 0 -2px 5px var(--shadow-color-light);
        transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }

    body.dark-mode .site-footer {
        background-color: var(--footer-bg-dark-grey); /* Changed to darker grey */
        color: var(--text-color-dark);
        box-shadow: 0 -2px 5px var(--shadow-color-dark);
    }

    .footer-content {
        display: flex;
        flex-direction: row; /* Single row on large screens */
        flex-wrap: wrap; /* Allow items to wrap if screen is not wide enough */
        justify-content: space-around; /* Distribute items with space around them */
        gap: 20px;
        max-width: 1200px; /* Increased max-width for better multi-column display */
        margin: 0 auto; /* Center the footer content */
        padding: 0 20px; /* Add padding for content inside footer */
        text-align: left; /* Default text alignment for multi-column */
    }

    .footer-section {
        flex: 1; /* Allow sections to grow and shrink */
        min-width: 200px; /* Minimum width for each column */
        max-width: 250px; /* Maximum width for each column to prevent excessive stretching */
        text-align: left; /* Align text left within each section */
    }

    .footer-section h3 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        color: var(--primary-color);
    }

    body.dark-mode .footer-section h3 {
        color: var(--accent-color);
    }

    .footer-section p,
    .footer-section a {
        font-size: 0.9rem;
        color: inherit;
        text-decoration: none;
        display: block;
        margin-bottom: 0.5rem;
        transition: color 0.3s ease;
    }

    .footer-section a:hover {
        color: var(--secondary-color); /* Apply hover color */
        text-decoration: underline; /* Add underline on hover */
    }

    /* Social Icons Container */
    .social-icons { 
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 1rem;
    }

    .social-icons img {
        height: 30px;
        width: 30px;
        transition: transform 0.2s ease, filter 0.3s ease;
    }

    .social-icons img:hover {
        transform: scale(1.1);
    }



    /* Responsive adjustments */
    @media (max-width: 768px) {
         .faq-question {
            font-size: 1em;
            padding: 12px 15px;
        }
        
        .footer-content {
            flex-direction: column; /* Stack vertically on small screens */
            align-items: center;
            text-align: center; /* Center text for stacked layout */
        }
        .footer-section {
            width: 100%; /* Full width for sections on small screens */
            max-width: unset; /* Remove max-width constraint */
            text-align: center; /* Center text within sections on mobile */
        }
        .social-icons {
            justify-content: center; /* Ensure social icons remain centered on mobile */
        }
    }
    /* Hero Section */
    html, body {
    width: 100%;
    margin: 0;
    padding: 0;
    overflow-x: hidden; /* Prevent horizontal scroll bar */
}

.hero-section-cinema {
    position: relative;
    width: 100vw; /* Ensure it takes the full viewport width */
    height: 300px; /* Adjust height as needed */
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    overflow: hidden;
    transition: background-image 0.5s ease-in-out;
    left: 50%; /* Center the element */
    transform: translateX(-50%); /* Pull it back by half its width to truly center and span full width */
}

.hero-content-cinema {
    position: absolute;
    width: 100%; /* Ensure content within also spans full width */
    text-align: center;
    overflow: hidden;
}
    .hero-text-cinema {
        font-size: 3rem;
        font-weight: 700;
        white-space: nowrap;
        animation: scrollText 20s linear infinite;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        color: white; /* Ensure text is visible on background */
    }

    @keyframes scrollText {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }

    /* Main Content Area */
    .cinema-guide-main {
        padding: 40px 20px;
        max-width: 1200px;
        margin: 0 auto;
        background-color: var(--bg);
        transition: background-color 0.3s ease;
    }

    .page-title {
        font-size: 2.5rem;
        color: var(--text);
        margin-bottom: 30px;
        text-align: center;
    }

    /* City Filter */
    .city-filter {
        text-align: center;
        margin-bottom: 40px;
    }

    .city-filter label {
        font-size: 1.2rem;
        color: #007bff; /* A slightly lighter blue for links and secondary actions */
        margin-right: 15px;
        font-weight: 500;
    }

    .city-filter select {
        padding: 10px 15px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        background-color: var(--card-bg);
        color: var(--text);
        font-size: 1rem;
        cursor: pointer;
        outline: none;
        appearance: none;
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23111%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.5H18.6c-5%200-9.3%201.8-13.2%206.5C1.8%2073.3%200%2077.5%200%2082.5c0%205%201.8%209.3%205.4%2013.2l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095.7c3.6-3.5%205.4-7.8%205.4-12.8%200-5-1.8-9.3-5.4-13.2z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 10px top 50%;
        background-size: 12px;
    }
    body.dark-mode .city-filter select {
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23f0f0f0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.5H18.6c-5%200-9.3%201.8-13.2%206.5C1.8%2073.3%200%2077.5%200%2082.5c0%205%201.8%209.3%205.4%2013.2l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095.7c3.6-3.5%205.4-7.8%205.4-12.8%200-5-1.8-9.3-5.4-13.2z%22%2F%3E%3C%2Fsvg%3E');
    }

    /* Cinema Halls Container */
    .city-cinema-halls-container {
        margin-top: 30px;
    }

    .cinema-hall-section {
        background-color: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 15px;
        box-shadow: 0 5px 15px var(--card-shadow);
        padding: 25px;
        margin-bottom: 40px;
    }

    .cinema-hall-title {
        font-size: 2rem;
        color: var(--highlight);
        margin-bottom: 25px;
        border-bottom: 2px solid var(--highlight);
        padding-bottom: 10px;
        display: inline-block;
    }

    .screening-shows-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
    }

    .show-card-cinema {
        background-color: var(--bg); /* Lighter background for individual show */
        border: 1px solid var(--dropdown-border);
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        display: flex;
        flex-direction: column;
    }

    .show-card-cinema:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }

    .show-card-cinema-poster-container {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 140%; /* Poster aspect ratio */
        overflow: hidden;
    }

    .show-card-cinema-poster {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }

    .show-card-cinema-details {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .show-card-cinema-title {
        font-size: 1.3rem;
        color: var(--text);
        margin-bottom: 8px;
        line-height: 1.2;
    }

    .show-card-cinema-meta {
        font-size: 0.9rem;
        color: var(--text);
        opacity: 0.7;
        margin-bottom: 10px;
    }

    .show-card-cinema-meta span i {
        color: gold;
        margin-right: 5px;
    }

    .show-card-cinema-episode-info {
        font-size: 0.85rem;
        color: var(--text);
        opacity: 0.8;
        margin-bottom: 10px;
    }

    .buy-ticket-btn {
        background-color: rgb(2, 106, 252);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: background-color 0.2s ease, transform 0.1s ease;
        margin-top: auto; /* Push button to bottom */
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .buy-ticket-btn:hover {
        background-color: #070bec;
        transform: translateY(-2px);
    }

    /* --- Booking Modal (Stepper) --- */
    #bookingModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(28, 27, 27, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0.3s ease, opacity 0.3s ease;
    }

    #bookingModal.show {
      visibility: visible;
      opacity: 1;
    }

    .booking-content {
      background-color: rgb(134, 184, 255);
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      width: 95%;
      max-width: 900px;
      height: 90%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .booking-header {
      padding: 15px 20px;
      background-color: var(--header-bg);
      border-bottom: 1px solid var(--dropdown-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .booking-header h2 {
      font-size: 1.5rem;
      color: var(--text);
    }

    .close-modal-btn {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: var(--text);
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .close-modal-btn:hover {
      color: var(--danger);
    }

/* Variables for stepper colors */
:root {
    --step-inactive: #888; /* Grey for inactive steps */
    --step-active: var(--highlight); /* Blue for the active step (using your existing highlight color) */
    --step-complete: #28a745; /* Green for completed steps */
    --primary-button: rgb(2, 106, 252);
    --primary-button-hover: #070bec;
    --secondary-button: #6c757d;
}

body.dark-mode {
    --step-inactive: #bbb;
    --step-active: #6699ff; /* Lighter blue for dark mode */
    --step-complete: #28a745; /* Green for completed steps */
    --primary-button: #6699ff;
    --primary-button-hover: #4477ee;
    --secondary-button: #5a6268;
}

/* Stepper progress container */
.stepper-progress {
    padding: 20px 10px; /* Increased padding */
    background-color: var(--search-bg);
    border-bottom: 1px solid var(--dropdown-border);
    display: flex;
    justify-content: space-around;
    align-items: flex-start; /* Align items to the start to manage vertical space */
    flex-wrap: wrap; /* Allow steps to wrap on smaller screens */
}

.step-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1; /* Distribute space equally */
    text-align: center;
    min-width: 80px; /* Ensure a minimum width for each step */
    margin: 5px; /* Add some margin between items */
}

.step-circle {
    width: 35px; /* Slightly larger circle */
    height: 35px; /* Slightly larger circle */
    border-radius: 50%;
    background-color: var(--step-inactive);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 700; /* Bolder number */
    margin-bottom: 8px; /* Increased space between circle and text */
    transition: background-color 0.3s ease, transform 0.2s ease;
    font-size: 1rem; /* Larger font size for the number */
    border: 2px solid transparent; /* Add a subtle border */
}

.step-item.active .step-circle {
    background-color: var(--step-active);
    border-color: var(--highlight); /* Highlight border for active step */
    transform: scale(1.1); /* Slightly enlarge active circle */
}

.step-item.completed .step-circle {
    background-color: var(--step-complete);
    border-color: var(--step-complete); /* Green border for completed step */
}

.step-name {
    font-size: 0.95rem; /* Larger font size for step name */
    color: var(--text);
    opacity: 0.8;
    transition: color 0.3s ease, opacity 0.3s ease;
    line-height: 1.2; /* Improve line spacing for readability */
}

.step-item.active .step-name {
    opacity: 1;
    font-weight: 700; /* Bolder text for active step */
    color: var(--step-active); /* Highlight color for active step name */
}

.step-item.completed .step-name {
    color: var(--step-complete); /* Green color for completed step name */
    font-weight: 600; /* Bold text for completed step */
}

/* Responsive adjustments for stepper on small screens */
@media (max-width: 600px) {
    .stepper-progress {
        padding: 15px 5px;
        justify-content: center; /* Center items when they wrap */
    }

    .step-item {
        min-width: unset; /* Remove min-width on very small screens */
        width: 30%; /* Allow more flexible wrapping */
        margin: 5px 2px; /* Reduce horizontal margin */
    }

    .step-name {
        font-size: 0.8rem; /* Smaller font for very small screens */
    }
}
    .step-content {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }

    /* Specific Step Styles */
    #step0-show-details .show-details-summary {
        display: flex;
        gap: 30px;
        align-items: flex-start;
        margin-bottom: 30px;
        background-color: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    #step0-show-details .show-details-summary img {
        width: 180px;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    #step0-show-details .show-info-summary {
        flex-grow: 1;
    }
    #step0-show-details .show-info-summary h3 {
        font-size: 2rem;
        color: var(--text);
        margin-bottom: 10px;
    }
    #step0-show-details .show-info-summary .meta-info {
        font-size: 0.95rem;
        color: var(--text);
        opacity: 0.8;
        margin-bottom: 15px;
    }
    #step0-show-details .show-info-summary .meta-info i {
        color: gold;
        margin-right: 5px;
    }
    #step0-show-details .show-info-summary p {
        font-size: 0.95rem;
        color: var(--text);
        line-height: 1.6;
        margin-bottom: 20px;
    }
    #step0-show-details .show-info-summary h4 {
        font-size: 1.1rem;
        color: var(--text);
        margin-bottom: 10px;
    }
    #step0-show-details .show-info-summary .cast-list-summary {
        font-size: 0.9rem;
        color: var(--text);
        opacity: 0.9;
        margin-bottom: 20px;
    }

    .proceed-to-purchase-btn {
        background-color: var(--primary-button);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 700;
        transition: background-color 0.2s ease, transform 0.1s ease;
        display: block;
        width: fit-content;
        margin: 0 auto;
    }
    .proceed-to-purchase-btn:hover {
        background-color: var(--primary-button-hover);
        transform: translateY(-2px);
    }

    /* Step 1: Seat Selection */
    #priceDisplay {
        text-align: right;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--highlight);
        margin-bottom: 20px;
        background-color: var(--search-bg);
        padding: 10px;
        border-radius: 8px;
    }
    .seat-selection-container {
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      background-color: var(--card-bg);
    }
    .screen-indicator {
      width: 80%;
      height: 10px;
      background-color: #333;
      margin: 0 auto 30px auto;
      border-radius: 5px;
      box-shadow: 0 3px 5px rgba(0,0,0,0.3);
    }
    .seats-grid {
      display: grid;
      grid-template-columns: repeat(15, 1fr); /* Example grid */
      gap: 8px;
      justify-content: center;
      width: fit-content;
      margin: 0 auto;
      padding: 20px;
      background-color: #f0f0f0; /* Light grey for seat area */
      border-radius: 10px;
    }
    body.dark-mode .seats-grid {
        background-color: #2a2a2a;
    }

    .seat {
      width: 30px;
      height: 30px;
      background-color: #c0c0c0; /* Available */
      border: 1px solid #999;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.7rem;
      font-weight: bold;
      transition: background-color 0.2s ease, transform 0.1s ease;
      color: #333;
    }
    .seat.occupied {
      background-color: #f44336; /* Red */
      cursor: not-allowed;
      opacity: 0.6;
      color: white;
    }
    .seat.selected {
      background-color: var(--highlight); /* Blue */
      color: white;
      transform: scale(1.05);
    }
    .seat:not(.occupied):hover {
      background-color: #a0a0a0;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      font-size: 0.9rem;
      color: var(--text);
    }
    .legend-item {
      display: flex;
      align-items: center;
    }
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 8px;
    }
    .legend-available { background-color: #c0c0c0; }
    .legend-occupied { background-color: #f44336; }
    .legend-selected { background-color: var(--highlight); }

    .stepper-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }
    .stepper-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: background-color 0.2s ease, transform 0.1s ease;
    }
    .stepper-btn.primary {
        background-color: var(--primary-button);
        color: white;
    }
    .stepper-btn.primary:hover:not(:disabled) {
        background-color: var(--primary-button-hover);
        transform: translateY(-2px);
    }
    .stepper-btn.secondary {
        background-color: var(--secondary-button);
        color: white;
    }
    .stepper-btn.secondary:hover:not(:disabled) {
        background-color: #5a6268;
        transform: translateY(-2px);
    }
    .stepper-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Step 2: Snacks */
    .snacks-options {
        margin-bottom: 20px;
        text-align: center;
    }
    .snacks-options input[type="radio"] {
        margin-right: 8px;
        transform: scale(1.2);
    }
    .snacks-options label {
        font-size: 1.1rem;
        color: var(--text);
        margin-right: 20px;
    }

    .snacks-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .snack-item {
        background-color: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .snack-item img {
        width: 100px;
        height: 100px;
        object-fit: contain;
        margin-bottom: 10px;
    }
    .snack-item label {
        font-size: 1.1rem;
        color: var(--text);
        font-weight: 500;
        margin-bottom: 5px;
    }
    .snack-item p {
        font-size: 0.9rem;
        color: var(--text);
        opacity: 0.8;
        margin-bottom: 10px;
    }
    .snack-item input[type="number"] {
        width: 70px;
        padding: 5px;
        border: 1px solid var(--dropdown-border);
        border-radius: 5px;
        text-align: center;
        font-size: 1rem;
        color: var(--text);
        background-color: var(--bg);
    }
    .snack-item input[type="number"]:disabled {
        background-color: #eee;
        cursor: not-allowed;
        opacity: 0.7;
    }
    body.dark-mode .snack-item input[type="number"]:disabled {
        background-color: #444;
    }

    /* Step 3: Cab Service */
    .cab-service-options {
        margin-top: 20px;
    }
    .cab-service-options label {
        font-size: 1.1rem;
        color: var(--text);
        margin-bottom: 10px;
        display: block;
    }
    .cab-service-toggle {
        margin-bottom: 20px;
    }
    .cab-service-toggle input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    .cab-service-toggle label {
        display: inline-block;
        margin-right: 20px;
    }

    .address-input-group {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .address-input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text);
    }
    .address-input-group input[type="text"] {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        background-color: var(--bg);
        color: var(--text);
        font-size: 1rem;
    }
    .address-input-group input[type="text"]:disabled {
        background-color: #eee;
        cursor: not-allowed;
        opacity: 0.7;
    }
    body.dark-mode .address-input-group input[type="text"]:disabled {
        background-color: #444;
    }

    .cab-stand-selection select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        background-color: var(--bg);
        color: var(--text);
        font-size: 1rem;
        appearance: none;
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23111%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.5H18.6c-5%200-9.3%201.8-13.2%206.5C1.8%2073.3%200%2077.5%200%2082.5c0%205%201.8%209.3%205.4%2013.2l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095.7c3.6-3.5%205.4-7.8%205.4-12.8%200-5-1.8-9.3-5.4-13.2z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 10px top 50%;
        background-size: 12px;
    }
    body.dark-mode .cab-stand-selection select {
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23f0f0f0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.5H18.6c-5%200-9.3%201.8-13.2%206.5C1.8%2073.3%200%2077.5%200%2082.5c0%205%201.8%209.3%205.4%2013.2l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095.7c3.6-3.5%205.4-7.8%205.4-12.8%200-5-1.8-9.3-5.4-13.2z%22%2F%3E%3C%2Fsvg%3E');
    }

    /* Step 4: Summary */
    .summary-details {
        font-size: 1.1rem;
        color: var(--text);
        line-height: 1.8;
    }
    .summary-details strong {
        color: var(--highlight);
    }
    .total-price-summary {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-button);
        text-align: right;
        margin-top: 30px;
        padding-top: 15px;
        border-top: 1px dashed var(--dropdown-border);
    }

    .payment-methods {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-top: 30px;
    }
    .payment-method-item {
        border: 2px solid var(--card-border);
        border-radius: 10px;
        padding: 15px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: var(--card-bg);
        width: 150px; /* Fixed width for payment options */
    }
    .payment-method-item.selected {
        border-color: var(--highlight);
        box-shadow: 0 0 15px rgba(28, 12, 241, 0.3);
        transform: translateY(-5px);
    }
    .payment-method-item img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        margin-bottom: 10px;
    }
    .payment-method-item span {
        font-weight: 600;
        color: var(--text);
    }

    /* Payment icons (inline SVG examples for better styling) */
    .mpesa-icon { background-color: #32c450; padding: 10px; border-radius: 8px; } /* M-Pesa green */
    .card-icon { background-color: #007bff; padding: 10px; border-radius: 8px; } /* Blue for card */
    .paypal-icon { background-color: #003087; padding: 10px; border-radius: 8px; } /* PayPal blue */
    .crypto-icon { background-color: #f7931a; padding: 10px; border-radius: 8px; } /* Bitcoin orange */

    .confirm-payment-btn {
        background-color: var(--primary-button);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.2rem;
        font-weight: 700;
        margin-top: 40px;
        display: block;
        width: fit-content;
        margin-left: auto;
        margin-right: auto;
        transition: background-color 0.2s ease, transform 0.1s ease;
    }
    .confirm-payment-btn:hover:not(:disabled) {
        background-color: var(--primary-button-hover);
        transform: translateY(-2px);
    }
    .confirm-payment-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Stepper navigation alignment */
    .stepper-navigation.center {
        justify-content: center;
        gap: 20px;
    }

    /* Responsive Design for Modal */
    @media (max-width: 768px) {
        .booking-content {
            width: 98%;
            height: 95%;
        }
        .booking-header h2 {
            font-size: 1.2rem;
        }
        .close-modal-btn {
            font-size: 1.5rem;
        }
        .stepper-progress {
            padding: 10px 10px;
        }
        .step-circle {
            width: 25px;
            height: 25px;
            font-size: 0.8rem;
        }
        .step-name {
            font-size: 0.75rem;
        }
        .step-content {
            padding: 15px;
        }
        #step0-show-details .show-details-summary {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        #step0-show-details .show-details-summary img {
            width: 150px;
        }
        #step0-show-details .show-info-summary h3 {
            font-size: 1.5rem;
        }
        #step0-show-details .show-info-summary .meta-info,
        #step0-show-details .show-info-summary p,
        #step0-show-details .show-info-summary .cast-list-summary {
            font-size: 0.85rem;
        }
        .proceed-to-purchase-btn {
            font-size: 1rem;
            padding: 10px 20px;
        }
        .seats-grid {
            grid-template-columns: repeat(10, 1fr); /* Adjust grid for smaller screens */
            gap: 6px;
            padding: 15px;
        }
        .seat {
            width: 25px;
            height: 25px;
            font-size: 0.6rem;
        }
        .legend {
            gap: 10px;
            font-size: 0.8rem;
        }
        .legend-color {
            width: 15px;
            height: 15px;
        }
        .snacks-container {
            grid-template-columns: repeat(2, 1fr); /* 2 columns on mobile */
            gap: 15px;
        }
        .snack-item {
            padding: 10px;
        }
        .snack-item img {
            width: 80px;
            height: 80px;
        }
        .snack-item label {
            font-size: 1rem;
        }
        .snack-item p {
            font-size: 0.8rem;
        }
        .snack-item input[type="number"] {
            width: 60px;
        }
        .no-thanks-option {
            font-size: 1rem;
        }
        .payment-methods {
            flex-direction: column;
            align-items: center;
        }
        .payment-method-item {
            width: 100%;
            max-width: 200px;
        }
    }

    @media (max-width: 480px) {
        .hero-text-cinema {
            font-size: 2rem;
        }
        .page-title {
            font-size: 2rem;
        }
        .city-filter label {
            font-size: 1rem;
            margin-right: 10px;
        }
        .city-filter select {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        .cinema-hall-title {
            font-size: 1.5rem;
        }
        .screening-shows-grid {
            grid-template-columns: 1fr; /* Single column */
        }
        .show-card-cinema-details {
            padding: 10px;
        }
        .show-card-cinema-title {
            font-size: 1.1rem;
        }
        .show-card-cinema-meta,
        .show-card-cinema-episode-info {
            font-size: 0.8rem;
        }
        .buy-ticket-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        .booking-content {
            height: 98%;
        }
        #priceDisplay {
            font-size: 1.2rem;
        }
        .seats-grid {
            grid-template-columns: repeat(8, 1fr); /* Even smaller seat grid */
            gap: 4px;
        }
        .snack-item img {
            width: 60px;
            height: 60px;
        }
        .snack-item label {
            font-size: 0.9rem;
        }
        .snack-item p {
            font-size: 0.75rem;
        }
        .snack-item input[type="number"] {
            width: 50px;
            font-size: 0.9rem;
        }
        .stepper-btn {
            font-size: 0.9rem;
            padding: 8px 15px;
        }
        .confirm-payment-btn {
            font-size: 1rem;
            padding: 10px 20px;
        }
    }
  </style>
</head>
<body>

  <!-- Initial Loading Screen -->
  <div id="loadingScreen">
    <div class="loading-text">Preparing Your Watch Experience</div>
    <div class="loading-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- Utility Header (Fixed/Sticky - contains Logo and Icons) -->
  <header id="utilityHeader">
    <div class="logo"><a href="cinewatch_home.html">CineWatch</a></div>
    <div class="header-icons">
      <i id="searchIcon" class="fas fa-search" title="Search"></i>
      <i id="addIcon" class="fas fa-plus-circle" title="Add to Watchlist"></i>
      <i id="accountIcon" class="fas fa-user-circle" title="Account"></i>
      <i id="darkModeToggle" class="fas fa-moon" title="Toggle Dark Mode"></i>
      <i id="hamburgerMenu" class="fas fa-bars" title="Menu"></i>
    </div>
  </header>

  <!-- Search Subheader (Initially hidden, slides down on search icon click) -->
  <div id="searchSubheader" class="search-subheader">
    <div class="search-bar-container">
      <input type="text" id="searchInput" placeholder="Search movies, series, genres..." autocomplete="off">
      <button id="clearSearch" class="clear-search-btn" title="Clear search"><i class="fas fa-times"></i></button>
    </div>
    <div id="suggestionsBox" class="suggestions-box">
      <!-- Search suggestions will be rendered here by JavaScript -->
    </div>
  </div>

  <!-- Account Dropdown (Hidden by default, appears on account icon click) -->
  <div id="accountDropdown" class="account-dropdown">
    <a href="login.html" id="loginLink">Login</a>
    <a href="signup.html" id="registerLink">Register</a>
    <a href="profile.html" id="profileLink" style="display:none;"><i class="fas fa-user"></i> Profile</a>
    <a href="#" id="playlistLink" class="account-item"><i class="fas fa-list-ul"></i> Playlist</a>
    <a href="#" id="bookmarksLink" class="account-item"><i class="fas fa-bookmark"></i> Bookmarks</a>
    <a href="#" id="favoritesLink" class="account-item"><i class="fas fa-heart"></i> Favorites</a>
    <a href="settings.html" id="settingsLink" class="account-item"><i class="fas fa-cog"></i> Settings</a>
    <a href="#" id="logoutLink" style="display:none;" class="account-item logout-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <!-- Main Subheader (Contains Nav Links and Tagline, Scrolls with page) -->
  <div id="mainSubheader" class="main-subheader">
    <p class="site-tagline">Stream, Discover, Repeat</p>
    <nav class="main-nav">
      <ul>
        <li><a href="movies.html">Movies</a></li>
        <li><a href="tv_shows.html">TV Shows</a></li>
        <li><a href="cinema_guide.html" class="active">Cinema Guide</a></li>
        <li><a href="about_us.html">About Us</a></li>
      </ul>
    </nav>
  </div>

  <!-- Mobile Navigation Overlay (Hidden by default, appears on hamburger click) -->
  <div id="mobileNavOverlay" class="mobile-nav-overlay">
    <div class="mobile-nav-content">
      <i id="closeMobileNav" class="fas fa-times close-btn"></i>
      <a href="cinewatch_home.html">Home</a>
      <a href="movies.html">Movies</a>
      <a href="tv_shows.html">TV Shows</a>
      <a href="cinema_guide.html" class="active">Cinema Guide</a>
      <a href="about_us.html">About Us</a>
      <a href="profile.html" id="mobileProfileLink" style="display:none;"><i class="fas fa-user"></i> Profile</a>
      <a href="#" class="mobile-login-btn" id="mobileLoginLink">Login / Register</a>
      <a href="#" class="mobile-logout-btn" id="mobileLogoutLink" style="display:none;">Logout</a>
    </div>
  </div>

  <main class="cinema-guide-main">
    <!-- Hero Section for Cinema Guide -->
    <section id="cinemaHero" class="hero-section-cinema">
        <div class="hero-content-cinema">
            <h1 class="hero-text-cinema">Showing in cinema Now</h1>
        </div>
    </section>

    <h1 class="page-title">Find Shows Near You</h1>

    <!-- City Filter -->
    <div class="city-filter">
        <label for="citySelect">Select City:</label>
        <select id="citySelect">
            <option value="all">All Cities</option>
            <option value="Nairobi">Nairobi</option>
            <option value="Kisumu">Kisumu</option>
            <option value="Mombasa">Mombasa</option>
            <option value="Eldoret">Eldoret</option>
            <option value="Nakuru">Nakuru</option>
        </select>
    </div>

    <!-- Cinema Halls Container -->
    <div id="cinemaHallsContainer" class="city-cinema-halls-container">
        <!-- Cinema halls and their shows will be dynamically loaded here -->
    </div>
  </main>

<!-- Site Footer (Unified Structure) -->
  <footer class="site-footer">
      <div class="footer-content">
          <div class="footer-section about">
              <h3>CineWatch</h3>
              <p>Your ultimate destination for movies and TV shows.</p>
          </div>
          <div class="footer-section quick-links">
              <h3>Quick Links</h3>
              <ul>
                  <li><a href="cinewatch_home.html">Home</a></li>
                  <li><a href="movies.html">Movies</a></li>
                  <li><a href="tv_shows.html">TV Shows</a></li>
                  <li><a href="cinema_guide.html">Cinema Guide</a></li>
              </ul>
          </div>
          <div class="footer-section developer-info">
              <h3>Developer</h3>
              <ul>
                  <li><a href="developer.html">About Alex Malunda</a></li>
                  <li><a href="https://github.com/Asleki" target="_blank" rel="noopener noreferrer">My GitHub</a></li>
              </ul>
          </div>
          <div class="footer-section legal-links">
              <h3>Legal</h3>
              <ul>
                  <li><a href="privacy_policy.html">Privacy Policy</a></li>
                  <li><a href="termsof_services.html">Terms of Service</a></li>
                  <li><a href="copyright_information.html">Copyright Information</a></li>
                  <li><a href="faqs.html">FAQs</a></li>
                  <li><a href="contact_us.html">Contact Us</a></li>
              </ul>
          </div>
          <div class="footer-section contact-social">
              <h3>Connect With Me</h3>
              <p>Email: <a href="mailto:alexmalunda@aol.com">alexmalunda@aol.com</a></p>
              <p>Last Modified: <span id="last-modified"></span></p>
              <div class="social-icons">
                <a href="https://www.instagram.com/yourprofile" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                      <img src="images/icons&logos/instagram_24dp.svg" alt="Instagram" onerror="this.onerror=null;this.src='https://placehold.co/30x30/000080/FFFFFF?text=Insta';">
                  </a>
                <a href="https://www.facebook.com/aslekiymastamynd" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                    <img src="images/icons&logos/facebook_24dp.svg" alt="Facebook" onerror="this.onerror=null;this.src='https://placehold.co/30x30/000080/FFFFFF?text=FB';">
                </a>
                <a href="https://www.linkedin.com/in/alexmalunda" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                    <img src="images/icons&logos/linkedin_24dp.svg" alt="LinkedIn" onerror="this.onerror=null;this.src='https://placehold.co/30x30/000080/FFFFFF?text=LI';">
                </a>
                <a href="https://x.com/yourhandle" target="_blank" rel="noopener noreferrer" aria-label="X (formerly Twitter)">
                    <img src="images/icons&logos/twitter_24dp.svg" alt="X (formerly Twitter)" onerror="this.onerror=null;this.src='https://placehold.co/30x30/000080/FFFFFF?text=X';">
                </a>
              </div>
          </div>
      </div>
  </footer>

  <!-- Custom Alert/Message Box (controlled by showMessageBox function in JS) -->
  <div id="customAlert" class="custom-alert-overlay">
    <div class="alert-content">
        <i class="fas fa-info-circle alert-icon blue-icon"></i>
        <p id="alertMessage">This is a custom message.</p>
        <button id="closeAlertBtn" class="close-alert-btn">OK</button>
    </div>
  </div>

  <!-- Booking Modal (Multi-step form) -->
  <div id="bookingModal" class="custom-alert-overlay">
    <div class="booking-content">
      <div class="booking-header">
        <h2 id="modalTitle">Book Your Tickets</h2>
        <button class="close-modal-btn" id="closeBookingModal">&times;</button>
      </div>
      <div class="stepper-progress">
        <div class="step-item active" data-step="0">
          <span class="step-circle">1</span>
          <span class="step-name">Details</span>
        </div>
        <div class="step-item" data-step="1">
          <span class="step-circle">2</span>
          <span class="step-name">Seats</span>
        </div>
        <div class="step-item" data-step="2">
          <span class="step-circle">3</span>
          <span class="step-name">Snacks</span>
        </div>
        <div class="step-item" data-step="3">
          <span class="step-circle">4</span>
          <span class="step-name">Cab</span>
        </div>
        <div class="step-item" data-step="4">
          <span class="step-circle">5</span>
          <span class="step-name">Summary</span>
        </div>
        <div class="step-item" data-step="5">
          <span class="step-circle">6</span>
          <span class="step-name">Payment</span>
        </div>
      </div>

      <div class="step-content">
        <!-- Step 0: Show Details Confirmation -->
        <div id="step0-show-details" class="booking-step active">
            <h3 style="text-align: center; color: var(--text); margin-bottom: 20px;">Confirm Your Selection</h3>
            <div class="show-details-summary">
                <img id="summaryShowPoster" src="" alt="Show Poster">
                <div class="show-info-summary">
                    <h3 id="summaryShowTitle"></h3>
                    <p class="meta-info">
                        <span id="summaryShowGenre"></span> | 
                        <span id="summaryShowYear"></span> | 
                        <span id="summaryShowRating"></span>
                    </p>
                    <p id="summaryShowDescription"></p>
                    <h4>Main Cast:</h4>
                    <p class="cast-list-summary" id="summaryShowCast"></p>
                </div>
            </div>
            <button class="proceed-to-purchase-btn" id="proceedToPurchase">Proceed to Purchase Ticket</button>
        </div>

        <!-- Step 1: Seat Selection -->
        <div id="step1-seat-selection" class="booking-step" style="display:none;">
            <div id="priceDisplay">Total Price: KES 0.00</div>
            <div class="seat-selection-container">
                <div class="screen-indicator"></div>
                <div id="seatsGrid" class="seats-grid">
                    <!-- Seats will be generated here -->
                </div>
                <div class="legend">
                    <div class="legend-item"><span class="legend-color legend-available"></span> Available</div>
                    <div class="legend-item"><span class="legend-color legend-occupied"></span> Occupied</div>
                    <div class="legend-item"><span class="legend-color legend-selected"></span> Selected</div>
                </div>
            </div>
            <div class="stepper-navigation center">
                <button class="stepper-btn primary" id="nextStep1" disabled>Proceed to Next</button>
            </div>
        </div>

        <!-- Step 2: Snacks -->
        <div id="step2-snacks" class="booking-step" style="display:none;">
            <h3 style="text-align: center; color: var(--text); margin-bottom: 20px;">Choose Your Snacks (Optional)</h3>
            <div class="snacks-options">
                <input type="radio" id="yesSnacks" name="snackSelectionOption" value="yes">
                <label for="yesSnacks">Yes, I want snacks</label>
                <input type="radio" id="noSnacks" name="snackSelectionOption" value="no" checked>
                <label for="noSnacks">No thanks, I don't want snacks</label>
            </div>
            <div class="snacks-container" id="snacksContainer">
                <!-- Snacks will be generated here -->
            </div>
            <div class="stepper-navigation">
                <button class="stepper-btn secondary" id="prevStep2">Back</button>
                <button class="stepper-btn primary" id="nextStep2">Proceed to Next</button>
            </div>
        </div>

        <!-- Step 3: Cab Service -->
        <div id="step3-cab-service" class="booking-step" style="display:none;">
            <h3 style="text-align: center; color: var(--text); margin-bottom: 20px;">Book a Cab (Optional)</h3>
            <div class="cab-service-options">
                <div class="cab-service-toggle">
                    <input type="radio" id="noCabService" name="cabOption" value="none" checked>
                    <label for="noCabService">No, I don't need a cab service</label>
                    <input type="radio" id="yesCabService" name="cabOption" value="yes">
                    <label for="yesCabService">Yes, I need a cab service</label>
                </div>

                <div id="cabDetails" style="display: none;">
                    <div class="address-input-group">
                        <input type="radio" id="pickupHome" name="pickupType" value="home" checked>
                        <label for="pickupHome">Pick up from my Home Address</label>
                        <input type="text" id="homeAddressInput" placeholder="Enter your home address" required>
                    </div>

                    <div class="address-input-group">
                        <input type="radio" id="pickupCabStand" name="pickupType" value="cab_stand">
                        <label for="pickupCabStand">Pick up from a Cab Stand</label>
                        <select id="cabStandSelect" disabled>
                            <option value="">Select a cab stand</option>
                            <!-- Cab stands dynamically loaded -->
                        </select>
                    </div>
                </div>
            </div>
            <div class="stepper-navigation">
                <button class="stepper-btn secondary" id="prevStep3">Back</button>
                <button class="stepper-btn primary" id="nextStep3">Proceed to Next</button>
            </div>
        </div>

        <!-- Step 4: Summary -->
        <div id="step4-summary" class="booking-step" style="display:none;">
            <h3 style="text-align: center; color: var(--text); margin-bottom: 20px;">Order Summary</h3>
            <div class="summary-details">
                <p><strong>Show:</strong> <span id="summaryShowName"></span></p>
                <p><strong>Cinema Hall:</strong> <span id="summaryCinemaHall"></span></p>
                <p><strong>City:</strong> <span id="summaryCity"></span></p>
                <p><strong>Seat:</strong> <span id="summarySeat"></span></p>
                <p><strong>Snacks:</strong> <span id="summarySnacks"></span></p>
                <p><strong>Cab Service:</strong> <span id="summaryCabService"></span></p>
                <p class="total-price-summary">Total Payable: KES <span id="summaryTotalPrice">0.00</span></p>
            </div>
            <div class="stepper-navigation">
                <button class="stepper-btn secondary" id="prevStep4">Back</button>
                <button class="stepper-btn primary" id="nextStep4">Proceed to Payment</button>
            </div>
        </div>

        <!-- Step 5: Payment -->
        <div id="step5-payment" class="booking-step" style="display:none;">
            <h3 style="text-align: center; color: var(--text); margin-bottom: 20px;">Select Payment Method</h3>
            <div class="payment-methods">
                <div class="payment-method-item" data-method="mpesa">
                    <img src="images/icons&logos/mpesa.svg" alt="M-Pesa" class="mpesa-icon">
                    <span>M-Pesa</span>
                </div>
                <div class="payment-method-item" data-method="card">
                    <img src="images/icons&logos/card.svg" alt="Card" class="card-icon">
                    <span>Card</span>
                </div>
                <div class="payment-method-item" data-method="paypal">
                    <img src="images/icons&logos/paypal.svg" alt="PayPal" class="paypal-icon">
                    <span>PayPal</span>
                </div>
                <div class="payment-method-item" data-method="crypto">
                    <img src="images/icons&logos/crypto.svg" alt="Crypto" class="crypto-icon">
                    <span>Crypto</span>
                </div>
            </div>
            <div class="stepper-navigation center">
                <button class="stepper-btn secondary" id="prevStep5">Back</button>
                <button class="confirm-payment-btn" id="confirmPaymentBtn" disabled>Confirm Payment</button>
            </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Consolidated JavaScript -->
  <script>
    /*
     * File: cinema_guide.js (Consolidated JavaScript for cinema_guide.html)
     * Description: Handles the entire cinema experience flow:
     * - Initial loading animation.
     * - Hero section dynamic images and scrolling text.
     * - City filtering for cinema halls.
     * - Dynamic rendering of cinema halls and their shows.
     * - Multi-step booking modal (show details, seat selection, snacks, cab, summary, payment).
     * - Price calculation and real-time updates.
     * - Cab service provider and stand selection based on city/cinema.
     * - Integrates with shared header/footer logic (search, account, dark mode).
     */

    // --- Global Data Definitions (from main.js and updated for cinema guide) ---

    // Placeholder for user login status (controlled by account dropdown logic)
    let userLoggedIn = false; // Default to false

    // Consolidated Show Data (with 'type' and 'popularityScore' added)
    const showsData = [
        {
            id: 'breakingbad', type: 'series', title: 'Breaking Bad', popularityScore: 95,
            poster: 'images/showposters/breakingbadposter1.webp', backdrop: 'images/backdrops/breakingbadbackdrop.webp',
            genre: ['Drama', 'Crime', 'Thriller'], year: 2008, rating: 9.5,
            description: 'A high school chemistry teacher diagnosed with lung cancer turns to manufacturing and selling methamphetamine in order to secure his family\'s future.',
            isFeatured: true, cast: ["Bryan Cranston", "Aaron Paul", "Anna Gunn"], awards: ["Golden Globe Award for Best Television Series  Drama", "Primetime Emmy Award for Outstanding Drama Series (x2)"],
            network: "AMC", networkLogo: "images/icons&logos/amclogo.svg"
        },
        {
            id: 'moneyheist', type: 'series', title: 'Money Heist', popularityScore: 90,
            poster: 'images/showposters/moneyheistposter.webp', backdrop: 'images/backdrops/moneyheistbackdrop.webp',
            genre: ['Crime', 'Drama', 'Thriller'], year: 2017, rating: 8.3,
            description: 'A mysterious man, "The Professor", recruits a band of eight robbers who take hostages and lock themselves in the Royal Mint of Spain as part of his elaborate plan to execute the biggest heist in history.',
            isFeatured: true, cast: ["rsula Corber", "lvaro Morte", "Itziar Ituo"], awards: ["International Emmy Award for Best Drama Series"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'strangerthings', type: 'series', title: 'Stranger Things', popularityScore: 92,
            poster: 'images/showposters/strangerthingsposter.webp', backdrop: 'images/backdrops/strangerthingsbackdrop.webp',
            genre: ['Sci-Fi', 'Horror', 'Drama', 'Fantasy'], year: 2016, rating: 8.7,
            description: 'When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces, and one strange little girl.',
            isFeatured: false, cast: ["Winona Ryder", "David Harbour", "Millie Bobby Brown"], awards: ["Screen Actors Guild Award for Outstanding Performance by an Ensemble in a Drama Series"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'theboys', type: 'series', title: 'The Boys', popularityScore: 88,
            poster: 'images/showposters/theboysposter.webp', backdrop: 'images/backdrops/theboysbackdrop.webp',
            genre: ['Action', 'Comedy', 'Drama', 'Sci-Fi'], year: 2019, rating: 8.7,
            description: 'A group of vigilantes known informally as "The Boys" set out to take down corrupt superheroes with no more than blue-collar grit and a willingness to fight dirty.',
            isFeatured: true, cast: ["Karl Urban", "Jack Quaid", "Antony Starr"], awards: ["Critics' Choice Super Award for Best Superhero Series"],
            network: "Amazon Prime Video", networkLogo: "images/icons&logos/amazonprimevideo.svg"
        },
        {
            id: 'wednesday', type: 'series', title: 'Wednesday', popularityScore: 85,
            poster: 'images/showposters/wednesdayposter.webp', backdrop: 'images/backdrops/wednesdaybackdrop.webp',
            genre: ['Comedy', 'Crime', 'Fantasy'], year: 2022, rating: 8.2,
            description: 'Wednesday Addams investigates a monstrous mystery at the school she attends.',
            isFeatured: false, cast: ["Jenna Ortega", "Gwendoline Christie", "Catherine Zeta-Jones"], awards: ["Hollywood Critics Association TV Award for Best Actress in a Streaming Series, Comedy (Jenna Ortega)"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'thecrown', type: 'series', title: 'The Crown', popularityScore: 78,
            poster: 'images/showposters/thecrownposter.webp', backdrop: 'images/backdrops/thecrownbackdrop.webp',
            genre: ['Drama', 'History', 'Biography'], year: 2016, rating: 8.7,
            description: 'Follows the political rivalries and romance of Queen Elizabeth II\'s reign and the events that shaped the second half of the 20th century.',
            isFeatured: false, cast: ["Claire Foy", "Olivia Colman", "Imelda Staunton"], awards: ["Golden Globe Award for Best Television Series  Drama (x2)", "Primetime Emmy Award for Outstanding Drama Series (x2)"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'thequeensgambit', type: 'series', title: 'The Queen\'s Gambit', popularityScore: 80,
            poster: 'images/showposters/thequeensgambitposter.webp', backdrop: 'images/backdrops/thequeensgambitbackdrop.webp',
            genre: ['Drama'], year: 2020, rating: 8.6,
            description: 'Orphaned at nine, prodigious chess prodigy Beth Harmon struggles with addiction in a quest to become the greatest chess player in the world.',
            isFeatured: false, cast: ["Anya Taylor-Joy", "Thomas Brodie-Sangster"], awards: ["Golden Globe Award for Best Television Limited Series, Anthology Series, or Motion Picture Made for Television", "Primetime Emmy Award for Outstanding Limited or Anthology Series"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'allofusaredead', type: 'series', title: 'All of Us Are Dead', popularityScore: 82,
            poster: 'images/showposters/allofusaredeadposter.webp', backdrop: 'images/backdrops/allofusaredeadbackdrop.webp',
            genre: ['Action', 'Drama', 'Fantasy', 'Horror'], year: 2022, rating: 7.5,
            description: 'A high school becomes ground zero for a zombie virus outbreak. Trapped students must fight their way out or turn into one of the infected.',
            isFeatured: true, cast: ["Park Ji-hu", "Yoon Chan-young", "Cho Yi-hyun"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'squidgame', type: 'series', title: 'Squid Game', popularityScore: 98,
            poster: 'images/showposters/squidgameposter1.webp', backdrop: 'images/backdrops/squidgamebackdrop.webp',
            genre: ['Action', 'Drama', 'Mystery', 'Thriller'], year: 2021, rating: 8.0,
            description: 'Hundreds of cash-strapped players accept a strange invitation to compete in children\'s games. Inside, a tempting prize awaits with deadly high stakes.',
            isFeatured: false, cast: ["Lee Jung-jae", "Park Hae-soo"], awards: ["Primetime Emmy Award for Outstanding Lead Actor in a Drama Series (Lee Jung-jae)", "Screen Actors Guild Award for Outstanding Performance by a Male Actor in a Drama Series (Lee Jung-jae)"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'thelastofus', type: 'series', title: 'The Last of Us', popularityScore: 93,
            poster: 'images/showposters/thelastofusposter.webp', backdrop: 'images/backdrops/thelastofusbackdrop.webp',
            genre: ['Action', 'Adventure', 'Drama', 'Sci-Fi'], year: 2023, rating: 8.8,
            description: 'After a global pandemic destroys civilization, a hardened survivor takes charge of a 14-year-old girl who may be humanity\'s last hope.',
            isFeatured: true, cast: ["Pedro Pascal", "Bella Ramsey"], awards: ["N/A"],
            network: "HBO", networkLogo: "images/icons&logos/hbo.svg"
        },
        {
            id: 'thewitcher', type: 'series', title: 'The Witcher', popularityScore: 84,
            poster: 'images/showposters/thewitcherposter.webp', backdrop: 'images/backdrops/thewitcherbackdrop.webp',
            genre: ['Action', 'Adventure', 'Drama', 'Fantasy'], year: 2019, rating: 8.2,
            description: 'Geralt of Rivia, a mutated monster-hunter for hire, journeys toward his destiny in a turbulent world where people often prove more wicked than beasts.',
            isFeatured: false, cast: ["Henry Cavill", "Freya Allan"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'arcane', type: 'series', title: 'Arcane', popularityScore: 89,
            poster: 'images/showposters/arcaneposter.webp', backdrop: 'images/backdrops/arcanedrop.webp',
            genre: ['Animation', 'Action', 'Adventure', 'Fantasy'], year: 2021, rating: 9.0,
            description: 'Set in utopian Piltover and the oppressed underground of Zaun, the story follows the origins of two iconic League of Legends champions and the power that will tear them apart.',
            isFeatured: false, cast: ["Hailee Steinfeld", "Ella Purnell"], awards: ["Primetime Emmy Award for Outstanding Animated Program"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'peakyblinders', type: 'series', title: 'Peaky Blinders', popularityScore: 86,
            poster: 'images/showposters/peakyblindersposter.webp', backdrop: 'images/backdrops/peakyblindersbackdrop.webp',
            genre: ['Crime', 'Drama'], year: 2013, rating: 8.8,
            description: 'A gangster family epic set in Birmingham, England in 1919, centering on a gang who sew razor blades in the peaks of their caps, and their ferocious boss Tommy Shelby.',
            isFeatured: false, cast: ["Cillian Murphy", "Helen McCrory"], awards: ["British Academy Television Award for Best Drama Series"],
            network: "BBC Two", networkLogo: "images/icons&logos/bbctwo.svg"
        },
        {
            id: 'dark', type: 'series', title: 'Dark', popularityScore: 83,
            poster: 'images/showposters/darkposter.webp', backdrop: 'images/backdrops/darkbackdrop.webp',
            genre: ['Crime', 'Drama', 'Mystery', 'Sci-Fi'], year: 2017, rating: 8.7,
            description: 'A family saga with a supernatural twist, set in a German town, where the disappearance of two young children exposes the double lives and fractured relationships among four families.',
            isFeatured: false, cast: ["Louis Hofmann", "Lisa Vicari"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'theoffice_us', type: 'series', title: 'The Office (US)', popularityScore: 87,
            poster: 'images/showposters/theofficeposter.webp', backdrop: 'images/backdrops/theofficebackdrop.webp',
            genre: ['Comedy'], year: 2005, rating: 9.0,
            description: 'A mockumentary on the everyday lives of a group of office employees in the Scranton, Pennsylvania, branch of the fictional Dunder Mifflin Paper Company.',
            isFeatured: false, cast: ["Steve Carell", "Rainn Wilson", "John Krasinski"], awards: ["Primetime Emmy Award for Outstanding Comedy Series"],
            network: "NBC", networkLogo: "images/icons&logos/nbclogo.svg"
        },
        {
            id: 'friends', type: 'series', title: 'Friends', popularityScore: 89,
            poster: 'images/showposters/friendsposter.webp', backdrop: 'images/backdrops/friendsbackdrop.webp',
            genre: ['Comedy', 'Romance'], year: 1994, rating: 8.9,
            description: 'Follows the personal and professional lives of six twenty-somethings living in Manhattan.',
            isFeatured: false, cast: ["Jennifer Aniston", "Courteney Cox", "Lisa Kudrow"], awards: ["Primetime Emmy Award for Outstanding Comedy Series"],
            network: "NBC", networkLogo: "images/icons&logos/nbclogo.svg"
        },
        {
            id: 'gameofthrones', type: 'series', title: 'Game of Thrones', popularityScore: 97,
            poster: 'images/showposters/gameofthronesposter.webp', backdrop: 'images/backdrops/gameofthronesbackdrop.webp',
            genre: ['Action', 'Adventure', 'Drama', 'Fantasy'], year: 2011, rating: 9.3,
            description: 'Nine noble families fight for control over the mythical lands of Westeros, while an ancient enemy returns after being dormant for thousands of years.',
            isFeatured: false, cast: ["Emilia Clarke", "Kit Harington", "Peter Dinklage"], awards: ["Primetime Emmy Award for Outstanding Drama Series (x4)", "Golden Globe Award for Best Television Series  Drama"],
            network: "HBO", networkLogo: "images/icons&logos/hbo.svg"
        },
        {
            id: 'thewalkingdead', type: 'series', title: 'The Walking Dead', popularityScore: 79,
            poster: 'images/showposters/thewalkingdeadposter.webp', backdrop: 'images/backdrops/thewalkingdeadbackdrop.webp',
            genre: ['Drama', 'Horror', 'Sci-Fi', 'Thriller'], year: 2010, rating: 8.1,
            description: 'Sheriff Deputy Rick Grimes wakes up from a coma to learn the world is in ruins and must lead a group of survivors to stay alive.',
            isFeatured: true, cast: ["Andrew Lincoln", "Norman Reedus"], awards: ["Saturn Award for Best Horror Television Series"],
            network: "AMC", networkLogo: "images/icons&logos/amclogo.svg"
        },
        {
            id: 'chernobyl', type: 'series', title: 'Chernobyl', popularityScore: 91,
            poster: 'images/showposters/chernobylposter.webp', backdrop: 'images/backdrops/chernobylbackdrop.webp',
            genre: ['Drama', 'History', 'Thriller'], year: 2019, rating: 9.4,
            description: 'In April 1986, an explosion at the Chernobyl nuclear power plant in the Ukrainian SSR becomes one of the world\'s worst man-made catastrophes.',
            isFeatured: false, cast: ["Jared Harris", "Stellan Skarsgrd"], awards: ["Golden Globe Award for Best Television Limited Series, Anthology Series, or Motion Picture Made for Television", "Primetime Emmy Award for Outstanding Limited or Anthology Series"],
            network: "HBO", networkLogo: "images/icons&logos/hbo.svg"
        },
        {
            id: "prisonbreak_series", type: 'series', title: "Prison Break", popularityScore: 86,
            poster: "images/showposters/prisonbreakposter1.webp", backdrop: 'images/backdrops/prisonbreakbackdrop.webp',
            genre: ["Action", "Hollywood", "Crime", "Drama", "Thriller"], year: 2005, rating: 8.3,
            description: "When his brother, Lincoln Burrows, is wrongly sentenced to death, a structural engineer, Michael Scofield, devises an elaborate plan to break him out of prisonstarting by getting incarcerated himself. A thrilling ride full of twists, tension, and brotherly loyalty as they navigate their escape and evade authorities.",
            isFeatured: true, cast: ["Wentworth Miller", "Dominic Purcell", "Sarah Wayne Callies"], awards: ["N/A"],
            network: "Fox", networkLogo: "images/icons&logos/foxlogo.svg"
        },
        {
            id: "yourhonor_series", type: 'series', title: "Your Honor", popularityScore: 75,
            poster: "images/showposters/yourhonorposter1.webp", backdrop: 'images/backdrops/yourhonorbackdrop.webp',
            genre: ["Hollywood", "Coming Soon", "Crime", "Drama", "Thriller"], year: 2024, rating: "Expected",
            description: "A respected New Orleans judge's life is turned upside down when his teenage son is involved in a hit-and-run, leading to a high-stakes game of lies, deceit, and impossible choices to protect his family. Season 3 is highly anticipated.",
            isFeatured: false, cast: ["Bryan Cranston", "Hunter Doohan", "Hope Davis"], awards: ["N/A"],
            network: "Showtime", networkLogo: "images/icons&logos/showtime.svg"
        },
        {
            id: "ghoul_series", type: 'series', title: "Ghoul", popularityScore: 65,
            poster: "images/showposters/ghoulposter1.webp", backdrop: 'images/backdrops/ghoulbackdrop.webp',
            genre: ["Bollywood", "Horror", "Thriller"], year: 2018, rating: 7.1,
            description: "A newly appointed interrogator arrives at a remote military detention center to question a dangerous terrorist, only to discover that the detainee is not what he seems and harbors a terrifying supernatural entity.",
            isFeatured: false, cast: ["Radhika Apte", "Manav Kaul", "S.M. Zaheer"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: "crimeandjustice_series", type: 'series', title: "Crime and Justice", popularityScore: 70,
            poster: "images/showposters/crimeandjusticeposter1.webp", backdrop: 'images/backdrops/crimeandjusticebackdrop.webp',
            genre: ["Kenyan Drama", "Trending", "Coming Soon", "Crime", "Drama", "Legal"], year: 2021, rating: 7.0,
            description: "A Kenyan police procedural series that follows two detectives as they investigate various crimes in Nairobi. The show delves into the dark side of the city, exploring themes of corruption, greed, and the pursuit of justice.",
            isFeatured: true, cast: ["Alfred Munyua", "Sarah Hassan", "Maqbul Mohammed"], awards: ["N/A"],
            network: "Showmax", networkLogo: "images/icons&logos/showmaxlogo.svg"
        },
        {
            id: "dayofthejackal_series", type: 'series', title: "The Day Of The Jackal", popularityScore: 68,
            poster: "images/showposters/thedayofthejackalposter1.webp", backdrop: 'images/backdrops/dayoftheljackalbackdrop.webp',
            genre: ["International", "Coming Soon", "Thriller"], year: 2024, rating: "Expected",
            description: "An upcoming modern-day reimagining of the iconic novel and film, following a professional assassin known as 'The Jackal' as he undertakes a mission to assassinate a high-profile target.",
            isFeatured: false, cast: ["Edward Fox", "Michael Lonsdale", "Terence Alexander"], awards: ["N/A"],
            network: "Peacock", networkLogo: "images/icons&logos/peacocklogo.svg"
        },
        {
            id: "secondwife_series", type: 'series', title: "Second Wife", popularityScore: 60,
            poster: "images/showposters/secondfamilyposter1.webp", backdrop: 'images/backdrops/secondfamilybackdrop.webp',
            genre: ["Kenyan Drama", "Coming Soon", "Drama"], year: "TBA", rating: "Expected",
            description: "Details for 'Second Wife' are scarce, but it's expected to be a compelling Kenyan drama exploring familial and marital complexities, possibly revolving around the theme of polygamy or a new spouse in a family.",
            isFeatured: false, cast: ["Vanessa Okeyo", "Serah Wanjiru"], awards: ["N/A"],
            network: "Maisha Magic Plus", networkLogo: "images/icons&logos/MaishaMagicPlus.svg"
        },
        {
            id: "kingdom_series", type: 'series', title: "Kingdom", popularityScore: 77,
            poster: "images/showposters/kingdomposter1.webp", backdrop: 'images/backdrops/kingdombackdrop.webp',
            genre: ["K-Drama", "Action", "Horror", "Thriller"], year: 2019, rating: 8.3,
            description: "While strange rumors about their ill King grip a kingdom, the crown prince becomes their only hope against a mysterious plague that is turning people into zombies.",
            isFeatured: false, cast: ["Ju Ji-hoon", "Ryu Seung-ryong"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: "thegoodplace", type: 'series', title: "The Good Place", popularityScore: 74,
            poster: "images/showposters/thegoodplaceposter.webp", backdrop: 'images/backdrops/goodplacebackdrop.webp',
            genre: ['Comedy', 'Fantasy', 'Drama'], year: 2016, rating: 8.2,
            description: 'Four people and their otherworldly architect struggle in the afterlife to define what it means to be good.',
            isFeatured: false, cast: ["Kristen Bell", "Ted Danson"], awards: ["Peabody Award"],
            network: "NBC", networkLogo: "images/icons&logos/nbclogo.svg"
        },
        {
            id: "mandolorian", type: 'series', title: "The Mandalorian", popularityScore: 89,
            poster: "images/showposters/mandolorianposter.webp", backdrop: 'images/backdrops/mandolorianbackdrop.webp',
            genre: ['Sci-Fi', 'Action', 'Adventure'], year: 2019, rating: 8.7,
            description: 'The travels of a lone bounty hunter in the outer reaches of the galaxy, far from the authority of the New Republic.',
            isFeatured: true, cast: ["Pedro Pascal", "Grogu (Baby Yoda)"], awards: ["Primetime Emmy Award for Outstanding Drama Series (Nomination)", "MTV Movie & TV Award for Best Duo (Pedro Pascal & Grogu)"],
            network: "Disney+", networkLogo: "images/icons&logos/disneypluslogo.svg"
        },
        {
            id: "severance", type: 'series', title: "Severance", popularityScore: 76,
            poster: "images/showposters/severanceposter.webp", backdrop: 'images/backdrops/severancebackdrop.webp',
            genre: ['Sci-Fi', 'Drama', 'Thriller'], year: 2022, rating: 8.7,
            description: 'A team of employees whose memories have been surgically divided between their work and personal lives discover the true nature of their jobs.',
            isFeatured: false, cast: ["Adam Scott", "Britt Lower"], awards: ["Primetime Emmy Award for Outstanding Drama Series (Nomination)"],
            network: "Apple TV+", networkLogo: "images/icons&logos/appletvplus.svg"
        },
        {
            id: "tedlasso", type: 'series', title: "Ted Lasso", popularityScore: 85,
            poster: "images/showposters/tedlassoposter.webp", backdrop: 'images/backdrops/tedlassobackdrop.webp',
            genre: ['Comedy', 'Sport'], year: 2020, rating: 8.8,
            description: 'American football coach Ted Lasso is hired to manage a British soccer team, despite having no experience coaching soccer.',
            isFeatured: true, cast: ["Jason Sudeikis", "Hannah Waddingham"], awards: ["Primetime Emmy Award for Outstanding Comedy Series (x2)", "Golden Globe Award for Best Television Series  Musical or Comedy"],
            network: "Apple TV+", networkLogo: "images/icons&logos/appletvplus.svg"
        },
        {
            id: "fleabag", type: 'series', title: "Fleabag", popularityScore: 72,
            poster: "images/showposters/fleabagposter.webp", backdrop: 'images/backdrops/fleabagbackdrop.webp',
            genre: ['Comedy', 'Drama'], year: 2016, rating: 8.7,
            description: 'A cynical woman navigates modern life in London while dealing with tragedy.',
            isFeatured: false, cast: ["Phoebe Waller-Bridge", "Andrew Scott"], awards: ["Primetime Emmy Award for Outstanding Comedy Series", "Golden Globe Award for Best Television Series  Musical or Comedy"],
            network: "BBC Three", networkLogo: "images/icons&logos/bbcthree.svg"
        },
        {
            id: "narcos", type: 'series', title: "Narcos", popularityScore: 81,
            poster: "images/showposters/narcosposter.webp", backdrop: 'images/backdrops/narcosbackdrop.webp',
            genre: ['Biography', 'Crime', 'Drama'], year: 2015, rating: 8.8,
            description: 'A chronicled look at the criminal exploits of Colombian drug lord Pablo Escobar, as well as the many other drug kingpins who plagued the country through the years.',
            isFeatured: true, cast: ["Wagner Moura", "Boyd Holbrook"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: "theboys_presents_diabolical", type: 'series', title: "The Boys Presents: Diabolical", popularityScore: 67,
            poster: "images/showposters/theboysdiabolicalposter.webp", backdrop: 'images/backdrops/theboysdiabolicalbackdrop.webp',
            genre: ['Animation', 'Action', 'Comedy'], year: 2022, rating: 7.3,
            description: 'An animated anthology series set in the universe of The Boys.',
            isFeatured: false, cast: ["Seth Rogen", "Andy Samberg"], awards: ["N/A"],
            network: "Amazon Prime Video", networkLogo: "images/icons&logos/amazonprimevideo.svg"
        },
        {
            id: "houseofthedragon", type: 'series', title: "House of the Dragon", popularityScore: 90,
            poster: "images/showposters/houseofthedragonposter.webp", backdrop: 'images/backdrops/houseofthedragonbackdrop.webp',
            genre: ['Action', 'Adventure', 'Drama', 'Fantasy'], year: 2022, rating: 8.5,
            description: 'The story of the Targaryen civil war that took place about 200 years before the events of Game of Thrones.',
            isFeatured: true, cast: ["Paddy Considine", "Matt Smith"], awards: ["Golden Globe Award for Best Television Series  Drama"],
            network: "HBO", networkLogo: "images/icons&logos/hbo.svg"
        },
        {
            id: "winningtime", type: 'series', title: "Winning Time: The Rise of the Lakers Dynasty", popularityScore: 69,
            poster: "images/showposters/winningtimeposter.webp", backdrop: 'images/backdrops/winningtimebackdrop.webp',
            genre: ['Biography', 'Drama', 'Sport'], year: 2022, rating: 8.2,
            description: 'A fast-break series about the professional and personal lives of the 1980s Los Angeles Lakers basketball team, one of sports\' most revered and dominant dynasties -- a team that defined an era, both on and off the court.',
            isFeatured: false, cast: ["Quincy Isaiah", "Solomon Hughes"], awards: ["N/A"],
            network: "HBO", networkLogo: "images/icons&logos/hbo.svg"
        },
        {
            id: 'moneyheist_kdrama', type: 'series', title: 'Money Heist (K-Drama)', popularityScore: 73,
            poster: 'images/showposters/moneyheist_koreaposter.webp', backdrop: 'images/backdrops/moneyheist_koreabackdrop.webp',
            genre: ['K-Drama', 'Crime', 'Drama', 'Thriller'], year: 2022, rating: 7.0,
            description: 'Thieves seize the Mint of Korea. With hostages trapped inside, the police must stop the crew  and the shadowy mastermind behind it all.',
            isFeatured: false, cast: ["Yoo Ji-tae", "Yunjin Kim", "Park Hae-soo"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: 'lupin', type: 'series', title: 'Lupin', popularityScore: 78,
            poster: 'images/showposters/lupinposter.webp', backdrop: 'images/backdrops/lupinbackdrop.webp',
            genre: ['Crime', 'Drama', 'Mystery'], year: 2021, rating: 7.5,
            description: 'Inspired by the adventures of Arsne Lupin, gentleman thief Assane Diop sets out to avenge his father for an injustice inflicted by a wealthy family.',
            isFeatured: false, cast: ["Omar Sy", "Ludivine Sagnier", "Etan Simon"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        // --- Movies (for full data reference, but filtered out on this page) ---
        {
            id: 'extraction', type: 'movie', title: 'Extraction', popularityScore: 80,
            poster: 'images/showposters/extractionposter1.webp', backdrop: 'images/backdrops/extractionbackdrop.webp',
            genre: ['Action', 'Thriller'], year: 2020, rating: 6.7,
            description: 'A black-market mercenary who has nothing to lose is hired to rescue the kidnapped son of an imprisoned international crime lord.',
            isFeatured: true, cast: ["Chris Hemsworth", "Rudhraksh Jaiswal", "Randeep Hooda"], awards: ["N/A"],
            network: "Netflix", networkLogo: "images/icons&logos/netflixlogo.svg"
        },
        {
            id: "inception_movie", type: 'movie', title: "Inception", popularityScore: 94,
            poster: "images/showposters/inceptioposter1.webp", backdrop: 'images/backdrops/inceptionbackdrop.webp',
            genre: ["Hollywood", "Action", "Sci-Fi", "Thriller"], year: 2010, rating: 8.8,
            description: "A thief who steals corporate secrets through use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O., but his tragic past may doom the mission and his team to disaster.",
            isFeatured: false, cast: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Elliot Page"], awards: ["Academy Award for Best Cinematography", "Academy Award for Best Sound Editing", "Academy Award for Best Sound Mixing", "Academy Award for Best Visual Effects"],
            network: "Warner Bros. Pictures", networkLogo: "images/icons&logos/warnerbros.svg"
        },
        {
            id: "3idiots_movie", type: 'movie', title: "3 Idiots", popularityScore: 85,
            poster: "images/showposters/3idiotsposter1.webp", backdrop: 'images/backdrops/3idiotsbackdrop.webp',
            genre: ["Bollywood", "Comedy", "Drama", "Romance"], year: 2009, rating: 8.4,
            description: "Two friends embark on a quest for a third, long-lost friend, while reminiscing about their college days and the profound impact their eccentric, brilliant buddy had on their lives and perspectives on education and success.",
            isFeatured: false, cast: ["Aamir Khan", "R. Madhavan", "Sharman Joshi"], awards: ["Filmfare Award for Best Film", "National Film Award for Best Popular Film Providing Wholesome Entertainment"],
            network: "Vinod Chopra Films", networkLogo: "images/icons&logos/filmstudio.svg"
        },
        {
            id: "dangal_movie", type: 'movie', title: "Dangal", popularityScore: 88,
            poster: "images/showposters/dangalposter1.webp", backdrop: 'images/backdrops/dangalbackdrop.webp',
            genre: ["Bollywood", "Biography", "Drama", "Sport"], year: 2016, rating: 8.3,
            description: "Based on the true story of Mahavir Singh Phogat, a former wrestler who trains his daughters Geeta Phogat and Babita Kumari to become world-class female wrestlers, challenging societal norms and achieving international success.",
            isFeatured: false, cast: ["Aamir Khan", "Fatima Sana Shaikh", "Sanya Malhotra"], awards: ["Filmfare Award for Best Film", "National Film Award for Best Popular Film Providing Wholesome Entertainment"],
            network: "Walt Disney Studios", networkLogo: "images/icons&logos/disneylogo.svg"
        },
        {
            id: "nairobihalflife_movie", type: 'movie', title: "Nairobi Half Life", popularityScore: 75,
            poster: "images/showposters/nairobihalflifeposter1.webp", backdrop: 'images/backdrops/nairobihalflifebackdrop.webp',
            genre: ["Kenyan Drama", "Crime", "Drama"], year: 2012, rating: 7.8,
            description: "Nairobi Half Life tells the story of Mwas, an aspiring actor from a rural town who travels to Nairobi to pursue his dreams. Faced with harsh city life, hes pulled into a world of crime and must struggle to stay true to his dreams while surviving the citys brutal realities. It's a powerful and gritty portrayal of urban life in Kenya.",
            isFeatured: false, cast: ["Joseph Wairimu", "Olwenya Maina", "Ogutu Muraya"], awards: ["Best Feature Film at the 33rd Durban International Film Festival"],
            network: "Ginger Ink Films", networkLogo: "images/icons&logos/tvnetwork.svg"
        },
        {
            id: "traintobusan_movie", type: 'movie', title: "Train To Busan", popularityScore: 79,
            poster: "images/showposters/traintobusanposter1.webp", backdrop: 'images/backdrops/traintobusanbackdrop.webp',
            genre: ["K-Drama", "Action", "Horror", "Thriller"], year: 2016, rating: 7.6,
            description: "While a zombie apocalypse breaks out in South Korea, a father and daughter, along with other passengers, are trapped on a high-speed train fighting for their lives as the infection spreads rapidly.",
            isFeatured: false, cast: ["Gong Yoo", "Jung Yu-mi", "Ma Dong-seok"], awards: ["Blue Dragon Film Award for Best New Director (Yeon Sang-ho)"],
            network: "Next Entertainment World", networkLogo: "images/icons&logos/tvnetwork.svg"
        },
        {
            id: "40sticks_movie", type: 'movie', title: "40 Sticks", popularityScore: 65,
            poster: "images/showposters/40sticksposter1.webp", backdrop: 'images/backdrops/40sticksbackdrop.webp',
            genre: ["Kenyan Drama", "Action", "Crime", "Thriller"], year: 2020, rating: 6.2,
            description: "When a prison bus crashes in the middle of a forest, a group of convicts must work together to survive the harsh wilderness while evading an unknown, deadly threat lurking in the shadows.",
            isFeatured: false, cast: ["Robert Agengo", "Mwaura Bilal", "Andreo Kamau"], awards: ["N/A"],
            network: "Netflix (Kenya)", networkLogo: "images/icons&logos/netflixlogo.svg"
        }
    ];

    // Data for Cinema Halls and their shows
    const cinemaData = {
        Nairobi: [
            {
                name: "Anga IMAX (CBD)",
                welcomeMessage: "Welcome to Anga IMAX, Nairobi! Prepare for an immersive cinematic journey!",
                shows: [
                    { id: 'inception_movie', time: '10:00 AM', price: 950, is3D: true, seats: generateRandomSeats(15, 10, 0.2) },
                    { id: 'squidgame', time: '01:00 PM', price: 800, isSeries: true, season: 1, episode: 'Pilot', seats: generateRandomSeats(15, 10, 0.3) },
                    { id: 'thelastofus', time: '04:00 PM', price: 850, isSeries: true, season: 1, episode: 'Infected', seats: generateRandomSeats(15, 10, 0.1) },
                    { id: 'extraction', time: '07:00 PM', price: 900, seats: generateRandomSeats(15, 10, 0.4) }
                ]
            },
            {
                name: "Prestige Plaza (Ngong Road)",
                welcomeMessage: "Enjoy your movie at Prestige Plaza! Comfort and convenience await.",
                shows: [
                    { id: 'moneyheist', time: '11:30 AM', price: 700, isSeries: true, season: 3, episode: 'The Game Begins', seats: generateRandomSeats(12, 8, 0.15) },
                    { id: 'dangal_movie', time: '02:30 PM', price: 650, seats: generateRandomSeats(12, 8, 0.2) },
                    { id: 'peakyblinders', time: '05:30 PM', price: 750, isSeries: true, season: 2, episode: 'Episode 3', seats: generateRandomSeats(12, 8, 0.1) },
                    { id: 'crimeandjustice_series', time: '08:00 PM', price: 600, isSeries: true, season: 1, episode: 'Justice Delayed', seats: generateRandomSeats(12, 8, 0.05) }
                ]
            },
            {
                name: "Two Rivers (Limuru Road)",
                welcomeMessage: "Welcome to Two Rivers Cinema! The ultimate family entertainment destination.",
                shows: [
                    { id: 'tedlasso', time: '10:00 AM', price: 700, isSeries: true, season: 3, episode: 'Sunflowers', seats: generateRandomSeats(10, 7, 0.1) },
                    { id: 'mandolorian', time: '01:00 PM', price: 750, isSeries: true, season: 2, episode: 'The Rescue', seats: generateRandomSeats(10, 7, 0.08) },
                    { id: '40sticks_movie', time: '04:00 PM', price: 600, seats: generateRandomSeats(10, 7, 0.25) }
                ]
            }
        ],
        Kisumu: [
            {
                name: "Mega City Cinemas",
                welcomeMessage: "Jambo Kisumu! Enjoy your film at Mega City Cinemas.",
                shows: [
                    { id: 'traintobusan_movie', time: '11:00 AM', price: 500, seats: generateRandomSeats(10, 7, 0.3) },
                    { id: 'ghoul_series', time: '02:00 PM', price: 450, isSeries: true, season: 1, episode: 'Episode 2', seats: generateRandomSeats(10, 7, 0.15) }
                ]
            },
            {
                name: "Lake Basin Mall Cinema",
                welcomeMessage: "Karibu Lake Basin Mall Cinema! Your comfort is our priority.",
                shows: [
                    { id: 'nairobihalflife_movie', time: '04:00 PM', price: 550, seats: generateRandomSeats(8, 6, 0.1) }
                ]
            }
        ],
        Mombasa: [
            {
                name: "Nyali Cinemax",
                welcomeMessage: "Welcome to Nyali Cinemax, Mombasa! Dive into the magic of movies by the coast.",
                shows: [
                    { id: 'inception_movie', time: '10:30 AM', price: 600, seats: generateRandomSeats(14, 9, 0.2) },
                    { id: 'squidgame', time: '01:30 PM', price: 550, isSeries: true, season: 1, episode: 'Red Light, Green Light', seats: generateRandomSeats(14, 9, 0.25) }
                ]
            },
            {
                name: "City Mall Cinema",
                welcomeMessage: "City Mall Cinema welcomes you! Your ultimate entertainment hub in Mombasa.",
                shows: [
                    { id: 'thelastofus', time: '04:30 PM', price: 650, isSeries: true, season: 1, episode: 'Long, Long Time', seats: generateRandomSeats(12, 8, 0.1) },
                    { id: 'moneyheist', time: '07:30 PM', price: 600, isSeries: true, season: 4, episode: 'The End of the Tunnel', seats: generateRandomSeats(12, 8, 0.05) }
                ]
            }
        ],
        Eldoret: [
            {
                name: "Rupa's Mall Cinema",
                welcomeMessage: "Greetings from Rupa's Mall Cinema, Eldoret! Great movies await.",
                shows: [
                    { id: 'breakingbad', time: '12:00 PM', price: 500, isSeries: true, season: 5, episode: 'Ozymandias', seats: generateRandomSeats(10, 7, 0.3) },
                    { id: 'tedlasso', time: '03:00 PM', price: 450, isSeries: true, season: 2, episode: 'No Weddings and a Funeral', seats: generateRandomSeats(10, 7, 0.1) }
                ]
            }
        ],
        Nakuru: [
            {
                name: "Westside Mall Cinema",
                welcomeMessage: "Hello Nakuru! Experience cinematic magic at Westside Mall.",
                shows: [
                    { id: '3idiots_movie', time: '01:00 PM', price: 500, seats: generateRandomSeats(10, 7, 0.2) },
                    { id: 'dangal_movie', time: '04:00 PM', price: 550, seats: generateRandomSeats(10, 7, 0.15) }
                ]
            }
        ]
    };

    // Cab Service Data
    const cabServiceData = {
        Uber: { logo: 'images/icons&logos/uberlogo.svg', locations: {
            Nairobi: ['Westlands Uber Cab Stand', 'Parklands Uber Cab Stand', 'Upperhill Uber Cab Stand', 'Lang\'ata Uber Cab Stand'],
            Kisumu: ['Nyalenda East Uber Cab Stand', 'Airport Uber Cab Stand'],
            Mombasa: ['Serena Uber Cab Stand', 'Bamburi Uber Cab Stand'],
            Eldoret: ['Langas Uber Cab Stand', 'Roadblock Uber Cab Stand'],
            Nakuru: ['Bahati Uber Cab Stand', 'Campus Drive Uber Cab Stand']
        }},
        Bolt: { logo: 'images/icons&logos/boltlogo.svg', locations: {
            Nairobi: ['CBD Bolt Cab Stand', 'Kilimani Bolt Cab Stand', 'Karen Bolt Cab Stand'],
            Kisumu: ['Milimani Bolt Cab Stand', 'Kisumu CBD Bolt Cab Stand'],
            Mombasa: ['Bombolulu Bolt Cab Stand', 'Mtwapa Bolt Cab Stand'],
            Eldoret: ['Laxo Bolt Cab Stand', 'Kapsoya Bolt Cab Stand'],
            Nakuru: ['Njoro Bolt Cab Stand', 'Town Centre Bolt Cab Stand']
        }},
        "Little Cab": { logo: 'images/icons&logos/littlecablogo.svg', locations: { // Assuming a logo path
            Nairobi: ['Gigiri Little Cab Stand', 'Lavington Little Cab Stand'],
            Kisumu: ['Bus Station Little Cab Stand'],
            Mombasa: ['Mpeketoni Little Cab Stand'],
            Eldoret: ['Plateau Little Cab Stand'],
            Nakuru: ['Milimani Little Cab Stand']
        }},
        Faras: { logo: 'images/icons&logos/faraslogo.svg', locations: { // Assuming a logo path
            Nairobi: ['Thika Road Faras Cab Stand', 'Ngong Road Faras Cab Stand'],
            Kisumu: ['Ondiek Faras Cab Stand'],
            Mombasa: ['Likoni Faras Cab Stand'],
            Eldoret: ['Huruma Faras Cab Stand'],
            Nakuru: ['Kapsabet Faras Cab Stand']
        }},
        Oya: { logo: 'images/icons&logos/oyalogo.svg', locations: { // Assuming a logo path
            Nairobi: ['Rongai Oya Cab Stand'],
            Kisumu: ['Bondo Oya Cab Stand'],
            Mombasa: ['Diani Oya Cab Stand'],
            Eldoret: ['Town Centre Oya Cab Stand'],
            Nakuru: ['Kiamunyi Oya Cab Stand']
        }}
    };

    const snacksData = [
        { name: "Popcorn (Large)", price: 300, image: "images/snacks/popcorns.webp" },
        { name: "Coca-Cola", price: 150, image: "images/snacks/cocacola.webp" },
        { name: "Nachos with Cheese", price: 400, image: "images/snacks/nachos.webp" },
        { name: "Bottled Water", price: 100, image: "images/snacks/bottledwater.webp" }
    ];


    // --- Global State for Booking ---
    let currentBooking = {
        show: null,
        cinemaHall: null,
        city: null,
        selectedSeat: null,
        snacks: [],
        cabService: {
            needed: false,
            pickupType: 'home', // 'home' or 'cab_stand'
            address: '',
            cabStand: ''
        },
        totalPrice: 0,
        selectedPaymentMethod: null
    };

    // --- Utility Functions (from main.js and standalone_header.js consolidated) ---

    /**
     * Displays a custom alert/message box to the user.
     * @param {string} message - The message to display.
     * @param {string} iconClasses - Font Awesome classes for the icon (e.g., "fas fa-check-circle green-icon").
     */
    function showMessageBox(message, iconClasses = "fas fa-info-circle blue-icon") {
        const customAlert = document.getElementById('customAlert');
        const alertMessage = document.getElementById('alertMessage');
        const alertIcon = customAlert.querySelector('.alert-icon');
        const closeAlertBtn = document.getElementById('closeAlertBtn');

        if (customAlert && alertMessage && alertIcon && closeAlertBtn) {
            alertMessage.textContent = message;
            alertIcon.className = 'alert-icon ' + iconClasses;
            customAlert.classList.add('show');

            const closeHandler = () => {
                customAlert.classList.remove('show');
                closeAlertBtn.removeEventListener('click', closeHandler);
            };
            closeAlertBtn.addEventListener('click', closeHandler);

            const overlayClickHandler = (event) => {
                if (event.target === customAlert) {
                    customAlert.classList.remove('show');
                    customAlert.removeEventListener('click', overlayClickHandler);
                }
            };
            customAlert.addEventListener('click', overlayClickHandler);
        } else {
            console.error("MessageBox elements not found. Cannot show message.");
        }
    }

    /**
     * Toggles dark mode on/off.
     */
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const darkModeToggle = document.getElementById('darkModeToggle');
        if (darkModeToggle) {
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.classList.replace('fa-moon', 'fa-sun');
                darkModeToggle.setAttribute('title', 'Toggle Light Mode');
            } else {
                darkModeToggle.classList.replace('fa-sun', 'fa-moon');
                darkModeToggle.setAttribute('title', 'Toggle Dark Mode');
            }
            // Store preference in local storage
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }
    }

    /**
     * Updates the visibility of login/logout/profile links in the account dropdown.
     * @param {boolean} isLoggedIn - True if the user is logged in, false otherwise.
     */
    function updateAccountDropdown(isLoggedIn) {
        const loginLink = document.getElementById('loginLink');
        const registerLink = document.getElementById('registerLink');
        const profileLink = document.getElementById('profileLink');
        const logoutLink = document.getElementById('logoutLink');
        const mobileLoginLink = document.getElementById('mobileLoginLink');
        const mobileLogoutLink = document.getElementById('mobileLogoutLink');
        const mobileProfileLink = document.getElementById('mobileProfileLink');

        const accountItems = document.querySelectorAll('.account-item');

        if (isLoggedIn) {
            if (loginLink) loginLink.style.display = 'none';
            if (registerLink) registerLink.style.display = 'none';
            if (profileLink) profileLink.style.display = 'flex';
            if (logoutLink) logoutLink.style.display = 'flex';
            if (mobileLoginLink) mobileLoginLink.style.display = 'none';
            if (mobileLogoutLink) mobileLogoutLink.style.display = 'flex';
            if (mobileProfileLink) mobileProfileLink.style.display = 'flex';

            accountItems.forEach(item => {
                if (item.id !== 'loginLink' && item.id !== 'registerLink' && item.id !== 'logoutLink' && item.id !== 'profileLink') {
                    item.style.display = 'flex';
                }
            });

        } else {
            if (loginLink) loginLink.style.display = 'flex';
            if (registerLink) registerLink.style.display = 'flex';
            if (profileLink) profileLink.style.display = 'none';
            if (logoutLink) logoutLink.style.display = 'none';
            if (mobileLoginLink) mobileLoginLink.style.display = 'flex';
            if (mobileLogoutLink) mobileLogoutLink.style.display = 'none';
            if (mobileProfileLink) mobileProfileLink.style.display = 'none';

            accountItems.forEach(item => {
                if (item.id !== 'loginLink' && item.id !== 'registerLink' && item.id !== 'logoutLink' && item.id !== 'profileLink') {
                    item.style.display = 'none';
                }
            });
        }
        userLoggedIn = isLoggedIn;
    }

    /**
     * Generates an array of unique values for a specified key from a dataset.
     * Used for populating search suggestions (e.g., unique genres, titles).
     * @param {Array<Object>} data - The dataset (e.g., showsData).
     * @param {string} key - The key to extract unique values from (e.g., 'genre', 'title').
     * @returns {Array<string>} An array of unique string values, sorted alphabetically.
     */
    function getUniqueValues(data, key) {
        if (!data || !Array.isArray(data)) return [];
        const unique = new Set();
        data.forEach(item => {
            if (item[key]) {
                if (Array.isArray(item[key])) {
                    item[key].forEach(subItem => unique.add(subItem.trim()));
                } else {
                    unique.add(item[key].trim());
                }
            }
        });
        return Array.from(unique).sort();
    }

    /**
     * Renders primary search suggestions (e.g., top genres or keywords).
     * @param {HTMLElement} container - The DOM element to render suggestions into.
     */
    function showPrimarySuggestions(container) {
        container.innerHTML = '';
        const suggestions = ['Action', 'Comedy', 'Drama', 'Sci-Fi', 'Thriller', 'Animation'];
        suggestions.forEach(s => {
            const div = document.createElement('div');
            div.classList.add('suggestion-item', 'primary-suggestion');
            div.textContent = s;
            div.addEventListener('click', () => {
                document.getElementById('searchInput').value = s;
                showMessageBox(`Searching for category: ${s}`);
                container.innerHTML = '';
            });
            container.appendChild(div);
        });
        container.classList.add('visible');
    }

    /**
     * Renders show title suggestions based on user input.
     * @param {HTMLElement} container - The DOM element to render suggestions into.
     * @param {string[]} titles - An array of matching show titles.
     */
    function renderShowTitleSuggestions(container, titles) {
        container.innerHTML = '';
        if (titles.length === 0) {
            container.classList.remove('visible');
            return;
        }
        titles.slice(0, 10).forEach(title => {
            const div = document.createElement('div');
            div.classList.add('suggestion-item');
            div.textContent = title;
            div.addEventListener('click', () => {
                document.getElementById('searchInput').value = title;
                showMessageBox(`Searching for show: ${title}`);
                container.innerHTML = '';
            });
            container.appendChild(div);
        });
        container.classList.add('visible');
    }

    // --- Cinema Guide Specific Functions ---

    // Hero section image and text animation
    // Adjusted paths to `images/cinema/`
    const heroBackgrounds = ['images/cinema/IMAX.webp', 'images/cinema/IMAX2.webp'];
    let currentHeroImageIndex = 0;
    const cinemaHero = document.getElementById('cinemaHero');

    function changeHeroBackground() {
        if (cinemaHero) {
            currentHeroImageIndex = (currentHeroImageIndex + 1) % heroBackgrounds.length;
            cinemaHero.style.backgroundImage = `url(${heroBackgrounds[currentHeroImageIndex]})`;
        }
    }

    // Generates a random seating arrangement for a cinema hall
    function generateRandomSeats(rows, cols, occupiedRatio) {
        const seats = [];
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                const isOccupied = Math.random() < occupiedRatio;
                const seatId = `${String.fromCharCode(65 + r)}${c + 1}`; // e.g., A1, A2...
                seats.push({ id: seatId, occupied: isOccupied, selected: false });
            }
        }
        return seats;
    }

    /**
     * Renders cinema halls and their shows based on the selected city.
     * @param {string} city - The city to filter by (e.g., 'Nairobi', 'all').
     */
    function renderCinemaHalls(city) {
        const container = document.getElementById('cinemaHallsContainer');
        container.innerHTML = '';

        const citiesToDisplay = city === 'all' ? Object.keys(cinemaData) : [city];

        citiesToDisplay.forEach(cityName => {
            const hallsInCity = cinemaData[cityName];
            if (!hallsInCity || hallsInCity.length === 0) {
                // If the city exists but has no halls, or if the city name is invalid.
                return;
            }

            hallsInCity.forEach(hall => {
                const hallSection = document.createElement('section');
                hallSection.classList.add('cinema-hall-section');
                hallSection.innerHTML = `
                    <h2 class="cinema-hall-title">${hall.name}</h2>
                    <div class="screening-shows-grid">
                        <!-- Shows for this hall will go here -->
                    </div>
                `;
                const showsGrid = hallSection.querySelector('.screening-shows-grid');

                hall.shows.forEach(showtime => {
                    const showDetails = showsData.find(s => s.id === showtime.id);
                    if (!showDetails) return; // Skip if show data is missing

                    const isExpected = showDetails.rating === "Expected";
                    const displayRating = isExpected ? showDetails.rating : `<i class="fas fa-star"></i> ${showDetails.rating}`;
                    const displayRelease = showDetails.year === "TBA" ? "" : ` | ${showDetails.year}`;
                    
                    let episodeInfo = '';
                    if (showtime.isSeries) {
                        episodeInfo = `<p class="show-card-cinema-episode-info">Season ${showtime.season || 'N/A'}, Episode ${showtime.episode || 'N/A'}</p>`;
                    }

                    const showCardHtml = `
                        <div class="show-card-cinema" data-show-id="${showDetails.id}" data-cinema-name="${hall.name}" data-city="${cityName}" data-show-time="${showtime.time}" data-ticket-price="${showtime.price}">
                            <div class="show-card-cinema-poster-container">
                                <img src="${showDetails.poster}" alt="${showDetails.title} Poster" class="show-card-cinema-poster" onerror="this.onerror=null;this.src='https://placehold.co/300x420/333/fff?text=No+Poster';">
                            </div>
                            <div class="show-card-cinema-details">
                                <h3 class="show-card-cinema-title">${showDetails.title}</h3>
                                <p class="show-card-cinema-meta">
                                    ${Array.isArray(showDetails.genre) ? showDetails.genre.join(', ') : showDetails.genre} ${displayRelease} | ${displayRating}
                                </p>
                                ${episodeInfo}
                                <button class="buy-ticket-btn"><i class="fas fa-ticket-alt"></i> Buy Ticket (KES ${showtime.price})</button>
                            </div>
                        </div>
                    `;
                    showsGrid.insertAdjacentHTML('beforeend', showCardHtml);
                });
                container.appendChild(hallSection);
            });
        });

        // Add event listeners to "Buy Ticket" buttons
        document.querySelectorAll('.buy-ticket-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const card = event.target.closest('.show-card-cinema');
                const showId = card.dataset.showId;
                const cinemaName = card.dataset.cinemaName;
                const city = card.dataset.city;
                const showTime = card.dataset.showTime;
                const ticketPrice = parseFloat(card.dataset.ticketPrice);

                const selectedShow = showsData.find(s => s.id === showId);
                const selectedCinemaHall = cinemaData[city].find(hall => hall.name === cinemaName);
                const selectedShowtimeDetails = selectedCinemaHall.shows.find(s => s.id === showId && s.time === showTime);


                currentBooking.show = selectedShow;
                currentBooking.cinemaHall = selectedCinemaHall;
                currentBooking.city = city;
                currentBooking.showtimeDetails = selectedShowtimeDetails; // Store for seat data
                currentBooking.totalPrice = ticketPrice; // Initial price
                currentBooking.selectedSeat = null; // Reset selected seat
                currentBooking.snacks = []; // Reset snacks when starting new booking
                
                openBookingModal(selectedShow);
            });
        });
    }

    // --- Booking Modal Logic ---
    const bookingModal = document.getElementById('bookingModal');
    const closeBookingModalBtn = document.getElementById('closeBookingModal');
    const stepperProgressItems = document.querySelectorAll('.step-item');
    const bookingSteps = document.querySelectorAll('.booking-step');
    let currentStep = 0;

    // Elements for price display
    const priceDisplay = document.getElementById('priceDisplay');
    const summaryTotalPriceSpan = document.getElementById('summaryTotalPrice');

    // Stepper navigation buttons
    const proceedToPurchaseBtn = document.getElementById('proceedToPurchase');
    const nextStep1Btn = document.getElementById('nextStep1');
    const prevStep2Btn = document.getElementById('prevStep2');
    const nextStep2Btn = document.getElementById('nextStep2');
    const prevStep3Btn = document.getElementById('prevStep3');
    const nextStep3Btn = document.getElementById('nextStep3');
    const prevStep4Btn = document.getElementById('prevStep4');
    const nextStep4Btn = document.getElementById('nextStep4');
    const prevStep5Btn = document.getElementById('prevStep5');
    const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');


    function openBookingModal(show) {
        // Populate Step 0 (Show Details Confirmation)
        document.getElementById('summaryShowPoster').src = show.poster;
        document.getElementById('summaryShowPoster').alt = `${show.title} Poster`;
        document.getElementById('summaryShowTitle').textContent = show.title;
        document.getElementById('summaryShowGenre').textContent = Array.isArray(show.genre) ? show.genre.join(', ') : show.genre;
        document.getElementById('summaryShowYear').textContent = show.year;
        document.getElementById('summaryShowRating').innerHTML = show.rating !== "Expected" ? `<i class="fas fa-star"></i> ${show.rating}` : show.rating;
        document.getElementById('summaryShowDescription').textContent = show.description;
        document.getElementById('summaryShowCast').textContent = show.cast && show.cast.length > 0 ? show.cast.slice(0, 3).join(', ') + (show.cast.length > 3 ? '...' : '') : 'N/A';

        // Set hero background of the modal to the show's backdrop
        bookingModal.querySelector('.booking-content').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url(${show.backdrop || show.poster})`;
        bookingModal.querySelector('.booking-content').style.backgroundSize = 'cover';
        bookingModal.querySelector('.booking-content').style.backgroundPosition = 'center';
        bookingModal.querySelector('.booking-content').style.color = 'white'; // Ensure text color is visible

        bookingModal.classList.add('show');
        updateStepper(0);
        showStep(0);
    }

    closeBookingModalBtn.addEventListener('click', () => {
        bookingModal.classList.remove('show');
        resetBookingModal();
    });

    function showStep(stepIndex) {
        bookingSteps.forEach((step, index) => {
            step.style.display = index === stepIndex ? 'block' : 'none';
        });
        updateStepper(stepIndex);
        updatePriceDisplay(); // Update price whenever step changes
        checkStepCompletion(stepIndex);
    }

    function updateStepper(activeStepIndex) {
        stepperProgressItems.forEach((item, index) => {
            item.classList.remove('active', 'completed');
            if (index === activeStepIndex) {
                item.classList.add('active');
            } else if (index < activeStepIndex) {
                item.classList.add('completed');
            }
        });
    }

    function resetBookingModal() {
        currentStep = 0;
        currentBooking = {
            show: null, cinemaHall: null, city: null, selectedSeat: null,
            snacks: [], cabService: { needed: false, pickupType: 'home', address: '', cabStand: '' },
            totalPrice: 0, selectedPaymentMethod: null
        };

        // Reset all steps to initial state
        document.getElementById('seatsGrid').innerHTML = ''; // Clear seats
        document.getElementById('noSnacks').checked = true; // Reset snacks radio
        document.querySelectorAll('.snack-qty').forEach(input => {
            input.value = 0;
            input.disabled = true; // Disable snack quantity inputs
        });
        document.getElementById('noCabService').checked = true; // Reset cab
        document.getElementById('cabDetails').style.display = 'none';
        document.getElementById('homeAddressInput').value = '';
        document.getElementById('homeAddressInput').disabled = false;
        document.getElementById('cabStandSelect').innerHTML = '<option value="">Select a cab stand</option>';
        document.getElementById('cabStandSelect').disabled = true;
        document.getElementById('pickupHome').checked = true;

        document.querySelectorAll('.payment-method-item').forEach(item => item.classList.remove('selected'));
        confirmPaymentBtn.disabled = true;

        updateStepper(0);
        showStep(0);
    }

    function updatePriceDisplay() {
        priceDisplay.textContent = `Total Price: KES ${currentBooking.totalPrice.toFixed(2)}`;
        summaryTotalPriceSpan.textContent = currentBooking.totalPrice.toFixed(2);
    }

    function checkStepCompletion(step) {
        if (step === 1) { // Seat selection step
            nextStep1Btn.disabled = !currentBooking.selectedSeat;
        } else if (step === 3) { // Cab service step
            // Cab button enable logic: if cab needed, either address or cab stand must be selected. If not needed, always enabled.
            const cabNeeded = document.getElementById('yesCabService').checked;
            let cabReady = true;
            if (cabNeeded) {
                const pickupHome = document.getElementById('pickupHome').checked;
                const pickupCabStand = document.getElementById('pickupCabStand').checked;

                if (pickupHome && homeAddressInput.value.trim() === '') {
                    cabReady = false;
                } else if (pickupCabStand && cabStandSelect.value === '') {
                    cabReady = false;
                }
            }
            nextStep3Btn.disabled = !cabReady;
        } else if (step === 5) { // Payment step
            confirmPaymentBtn.disabled = !currentBooking.selectedPaymentMethod;
        }
    }


    // Stepper Navigation Handlers
    proceedToPurchaseBtn.addEventListener('click', () => {
        currentStep = 1;
        showStep(currentStep);
        renderSeats(); // Render seats for the selected show
    });

    nextStep1Btn.addEventListener('click', () => {
        if (currentBooking.selectedSeat) {
            currentStep = 2;
            showStep(currentStep);
            renderSnacks(); // Render snacks for the step
            updateSnacksInputsState(); // Ensure inputs are enabled/disabled correctly on step entry
        } else {
            showMessageBox("Please select a seat to proceed!", "fas fa-exclamation-circle orange-icon");
        }
    });

    prevStep2Btn.addEventListener('click', () => {
        currentStep = 1;
        showStep(currentStep);
    });
    nextStep2Btn.addEventListener('click', () => {
        currentStep = 3;
        showStep(currentStep);
        updateCabOptions(); // Load cab options based on selected cinema/city
    });

    prevStep3Btn.addEventListener('click', () => {
        currentStep = 2;
        showStep(currentStep);
    });
    nextStep3Btn.addEventListener('click', () => {
        if (!nextStep3Btn.disabled) { // Only proceed if validation passes
            currentStep = 4;
            showStep(currentStep);
            updateSummary(); // Populate summary details
        }
    });

    prevStep4Btn.addEventListener('click', () => {
        currentStep = 3;
        showStep(currentStep);
    });
    nextStep4Btn.addEventListener('click', () => {
        currentStep = 5;
        showStep(currentStep);
    });

    prevStep5Btn.addEventListener('click', () => {
        currentStep = 4;
        showStep(currentStep);
    });

    confirmPaymentBtn.addEventListener('click', () => {
        if (currentBooking.selectedPaymentMethod) {
            const welcomeMessage = currentBooking.cinemaHall.welcomeMessage || "Enjoy your show!";
            showMessageBox(`Payment successful via ${currentBooking.selectedPaymentMethod}! ${welcomeMessage}`, "fas fa-check-circle green-icon");
            setTimeout(() => {
                bookingModal.classList.remove('show');
                resetBookingModal();
                // Optionally refresh cinema guide or redirect to home
                // window.location.reload();
            }, 3000); // Close modal and reset after 3 seconds
        } else {
            showMessageBox("Please select a payment method!", "fas fa-exclamation-triangle orange-icon");
        }
    });

    // --- Seat Selection (Step 1) ---
    const seatsGrid = document.getElementById('seatsGrid');
    const seatPrice = 100; // Base price per seat (example)

    function renderSeats() {
        seatsGrid.innerHTML = '';
        const showtimeDetails = currentBooking.showtimeDetails;
        if (!showtimeDetails || !showtimeDetails.seats) {
            seatsGrid.innerHTML = '<p>Seating information not available.</p>';
            return;
        }

        showtimeDetails.seats.forEach(seat => {
            const seatDiv = document.createElement('div');
            seatDiv.classList.add('seat');
            seatDiv.textContent = seat.id;
            seatDiv.dataset.seatId = seat.id;

            if (seat.occupied) {
                seatDiv.classList.add('occupied');
            } else {
                seatDiv.addEventListener('click', () => {
                    // Deselect previous seat
                    const previouslySelected = seatsGrid.querySelector('.seat.selected');
                    if (previouslySelected && previouslySelected !== seatDiv) {
                        previouslySelected.classList.remove('selected');
                        // No change to total price for initial seat selection
                    }

                    // Select current seat
                    seatDiv.classList.toggle('selected');
                    if (seatDiv.classList.contains('selected')) {
                        currentBooking.selectedSeat = seat.id;
                        currentBooking.totalPrice = currentBooking.showtimeDetails.price; // Base ticket price
                    } else {
                        currentBooking.selectedSeat = null;
                        currentBooking.totalPrice = currentBooking.showtimeDetails.price; // Reset to base ticket price if no seat selected
                    }
                    updatePriceDisplay();
                    checkStepCompletion(1); // Check if next button should be enabled
                });
            }
            seatsGrid.appendChild(seatDiv);
        });

        // Ensure the next button is initially disabled if no seat is selected
        nextStep1Btn.disabled = !currentBooking.selectedSeat;
        updatePriceDisplay(); // Initial price display
    }

    // --- Snacks Selection (Step 2) ---
    const snacksContainer = document.getElementById('snacksContainer');
    const yesSnacksRadio = document.getElementById('yesSnacks');
    const noSnacksRadio = document.getElementById('noSnacks');


    function renderSnacks() {
        snacksContainer.innerHTML = '';
        snacksData.forEach(snack => {
            const snackItem = document.createElement('div');
            snackItem.classList.add('snack-item');
            snackItem.innerHTML = `
                <img src="${snack.image}" alt="${snack.name}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/333/fff?text=Snack';">
                <label>${snack.name}</label>
                <p>KES ${snack.price.toFixed(2)}</p>
                <input type="number" class="snack-qty" data-snack-name="${snack.name}" data-snack-price="${snack.price}" value="0" min="0">
            `;
            snacksContainer.appendChild(snackItem);
        });

        // Event listener for quantity changes
        document.querySelectorAll('.snack-qty').forEach(input => {
            input.addEventListener('change', updateSnacksSelection);
            input.addEventListener('input', updateSnacksSelection); // Also listen to input
        });

        // Event listeners for "Yes/No" snacks radio buttons
        yesSnacksRadio.addEventListener('change', updateSnacksInputsState);
        noSnacksRadio.addEventListener('change', updateSnacksInputsState);

        // Initial update of snacks and price
        updateSnacksSelection();
        updateSnacksInputsState(); // Set initial state of inputs
    }

    function updateSnacksInputsState() {
        const snackQuantities = document.querySelectorAll('.snack-qty');
        if (noSnacksRadio.checked) {
            snackQuantities.forEach(input => {
                input.value = 0; // Reset quantities
                input.disabled = true; // Disable inputs
            });
            currentBooking.snacks = []; // Clear selected snacks
        } else {
            snackQuantities.forEach(input => {
                input.disabled = false; // Enable inputs
            });
        }
        updateSnacksSelection(); // Recalculate price based on the state change
    }

    function updateSnacksSelection() {
        currentBooking.snacks = [];
        let snacksCost = 0;

        if (yesSnacksRadio.checked) { // Only calculate if "Yes" is selected
            document.querySelectorAll('.snack-qty').forEach(input => {
                const qty = parseInt(input.value) || 0;
                if (qty > 0) {
                    const name = input.dataset.snackName;
                    const price = parseFloat(input.dataset.snackPrice);
                    currentBooking.snacks.push({ name: name, qty: qty, price: price });
                    snacksCost += qty * price;
                }
            });
        }
        // Recalculate total price: Base ticket price + snacks cost
        // Ensure currentBooking.showtimeDetails is not null, fallback to 0 if not set yet
        const baseTicketPrice = currentBooking.showtimeDetails ? currentBooking.showtimeDetails.price : 0;
        currentBooking.totalPrice = baseTicketPrice + snacksCost;
        updatePriceDisplay();
    }


    // --- Cab Service (Step 3) ---
    const noCabServiceRadio = document.getElementById('noCabService');
    const yesCabServiceRadio = document.getElementById('yesCabService');
    const cabDetailsDiv = document.getElementById('cabDetails');
    const pickupHomeRadio = document.getElementById('pickupHome');
    const pickupCabStandRadio = document.getElementById('pickupCabStand');
    const homeAddressInput = document.getElementById('homeAddressInput');
    const cabStandSelect = document.getElementById('cabStandSelect');

    function updateCabOptions() {
        const city = currentBooking.city;
        const cinemaHall = currentBooking.cinemaHall;

        // Reset inputs and selection
        homeAddressInput.value = '';
        cabStandSelect.innerHTML = '<option value="">Select a cab stand</option>';
        
        // Reset cab service in currentBooking
        currentBooking.cabService = { needed: false, pickupType: 'home', address: '', cabStand: '' };

        if (yesCabServiceRadio.checked) {
            cabDetailsDiv.style.display = 'block';
            pickupHomeRadio.checked = true; // Default to home pickup
            homeAddressInput.disabled = false; // Enable home address input
            cabStandSelect.disabled = true; // Disable cab stand select
            
            currentBooking.cabService.needed = true;
            currentBooking.cabService.pickupType = 'home';

            // Populate cab stands based on cinema's city
            if (city && cabServiceData) {
                // Find all unique cab stands for the current city across all providers
                let cityCabStands = new Set();
                for (const provider in cabServiceData) {
                    if (cabServiceData[provider].locations[city]) {
                        cabServiceData[provider].locations[city].forEach(stand => cityCabStands.add(stand));
                    }
                }
                Array.from(cityCabStands).sort().forEach(stand => {
                    const option = document.createElement('option');
                    option.value = stand;
                    option.textContent = stand;
                    cabStandSelect.appendChild(option);
                });
            }

        } else {
            cabDetailsDiv.style.display = 'none';
            currentBooking.cabService.needed = false;
        }
        checkStepCompletion(3); // Update next button
    }

    noCabServiceRadio.addEventListener('change', updateCabOptions);
    yesCabServiceRadio.addEventListener('change', updateCabOptions);

    pickupHomeRadio.addEventListener('change', () => {
        homeAddressInput.disabled = false;
        cabStandSelect.disabled = true;
        cabStandSelect.value = ''; // Clear selected cab stand
        currentBooking.cabService.pickupType = 'home';
        currentBooking.cabService.cabStand = '';
        checkStepCompletion(3);
    });

    pickupCabStandRadio.addEventListener('change', () => {
        homeAddressInput.disabled = true;
        homeAddressInput.value = ''; // Clear home address
        cabStandSelect.disabled = false;
        currentBooking.cabService.pickupType = 'cab_stand';
        currentBooking.cabService.address = '';
        checkStepCompletion(3);
    });

    homeAddressInput.addEventListener('input', () => {
        currentBooking.cabService.address = homeAddressInput.value.trim();
        checkStepCompletion(3);
    });

    cabStandSelect.addEventListener('change', () => {
        currentBooking.cabService.cabStand = cabStandSelect.value;
        checkStepCompletion(3);
    });

    // Initial check for cab service step on load (or when step 3 is shown)
    // This is handled by checkStepCompletion(3) which is called in updateCabOptions()

    // --- Summary (Step 4) ---
    function updateSummary() {
        document.getElementById('summaryShowName').textContent = currentBooking.show ? currentBooking.show.title : 'N/A';
        document.getElementById('summaryCinemaHall').textContent = currentBooking.cinemaHall ? currentBooking.cinemaHall.name : 'N/A';
        document.getElementById('summaryCity').textContent = currentBooking.city || 'N/A';
        document.getElementById('summarySeat').textContent = currentBooking.selectedSeat || 'None selected';

        let snacksSummary = "None";
        if (currentBooking.snacks.length > 0) {
            snacksSummary = currentBooking.snacks.map(s => `${s.qty}x ${s.name}`).join(', ');
        }
        document.getElementById('summarySnacks').textContent = snacksSummary;

        let cabSummary = "Not needed";
        if (yesCabServiceRadio.checked) {
            if (pickupHomeRadio.checked && homeAddressInput.value) {
                cabSummary = `Home: ${homeAddressInput.value}`;
            } else if (pickupCabStandRadio.checked && cabStandSelect.value) {
                cabSummary = `Cab Stand: ${cabStandSelect.value}`;
            } else {
                cabSummary = "Cab service selected, but no details provided.";
            }
        }
        document.getElementById('summaryCabService').textContent = cabSummary;

        updatePriceDisplay(); // Ensures total price is updated
    }

    // --- Payment (Step 5) ---
    document.querySelectorAll('.payment-method-item').forEach(item => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.payment-method-item').forEach(p => p.classList.remove('selected'));
            item.classList.add('selected');
            currentBooking.selectedPaymentMethod = item.dataset.method;
            checkStepCompletion(5); // Enable confirm button
        });
    });


    // --- Event Listeners and Initial Page Load Logic ---

    document.addEventListener("DOMContentLoaded", () => {
        // --- Initial Loading Screen Animation ---
        setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                // Remove loading screen from DOM after transition
                loadingScreen.addEventListener('transitionend', () => loadingScreen.remove());
            }
        }, 3000); // 3 seconds loading

        // --- Cinema Hero Background Cycling ---
        if (cinemaHero) {
            // Set initial background
            cinemaHero.style.backgroundImage = `url(${heroBackgrounds[currentHeroImageIndex]})`;
            // Start cycling backgrounds
            setInterval(changeHeroBackground, 5000); // Change every 5 seconds
        }

        // --- Header Search and Mobile Nav Logic (from standalone_header.js consolidated) ---
        const searchIcon = document.getElementById("searchIcon");
        const searchSubheader = document.getElementById("searchSubheader");
        const searchInput = document.getElementById("searchInput");
        const clearSearch = document.getElementById("clearSearch");
        const suggestionsBox = document.getElementById("suggestionsBox");
        const darkModeToggle = document.getElementById("darkModeToggle");
        const addIcon = document.getElementById("addIcon");
        const accountIcon = document.getElementById("accountIcon");
        const accountDropdown = document.getElementById("accountDropdown");
        const hamburgerMenu = document.getElementById("hamburgerMenu");
        const mobileNavOverlay = document.getElementById("mobileNavOverlay");

        // Ensure all necessary elements are present
        if (!searchIcon || !searchSubheader || !searchInput || !suggestionsBox ||
            !darkModeToggle || !addIcon || !accountIcon || !accountDropdown ||
            !hamburgerMenu || !mobileNavOverlay) {
            console.error("Critical header elements are missing. Header functionality may be limited.");
        } else {
             // State variables for search
            let searchScope = null;
            let selectedIndex = -1;

            searchIcon.addEventListener("click", () => {
                searchSubheader.classList.toggle("visible");
                if (searchSubheader.classList.contains("visible")) {
                    searchInput.focus();
                    if (!searchScope) {
                        showPrimarySuggestions(suggestionsBox);
                    }
                } else {
                    suggestionsBox.classList.remove("visible");
                    searchInput.value = "";
                    searchScope = null;
                    selectedIndex = -1;
                }
            });

            clearSearch.addEventListener("click", () => {
                searchInput.value = "";
                searchScope = null;
                selectedIndex = -1;
                showPrimarySuggestions(suggestionsBox);
                searchInput.focus();
            });

            searchInput.addEventListener("input", () => {
                selectedIndex = -1;
                const val = searchInput.value.trim();

                if (!searchScope) {
                    if (val === "") {
                        showPrimarySuggestions(suggestionsBox);
                    } else {
                        renderShowTitleSuggestions(suggestionsBox, showsData.filter(s =>
                            s.title.toLowerCase().includes(val.toLowerCase()) ||
                            (Array.isArray(s.genre) && s.genre.some(g => g.toLowerCase().includes(val.toLowerCase()))) ||
                            (s.cast && s.cast.some(c => c.name.toLowerCase().includes(val.toLowerCase())))
                        ).map(s => s.title));
                    }
                } else {
                    const [scopeType, scopeValue] = searchScope.split(':');
                    const filteredByScope = showsData.filter(s => {
                        if (scopeType === "genre" && Array.isArray(s.genre)) return s.genre.some(g => g.toLowerCase() === scopeValue.toLowerCase());
                        return true;
                    });
                    renderShowTitleSuggestions(suggestionsBox, filteredByScope.filter(s =>
                        s.title.toLowerCase().includes(val.toLowerCase())
                    ).map(s => s.title));
                }
            });

            suggestionsBox.addEventListener("click", (event) => {
                const target = event.target;
                if (target.classList.contains('suggestion-item')) {
                    const suggestionText = target.textContent.trim();
                    const showTitleMatch = showsData.find(show => show.title === suggestionText.split(' (')[0]);

                    if (showTitleMatch) {
                        window.location.href = `details.html?title=${encodeURIComponent(showTitleMatch.title)}`;
                    } else if (target.classList.contains('primary-suggestion')) {
                        searchScope = `genre:${suggestionText}`;
                        searchInput.value = `${suggestionText}: `;
                        suggestionsBox.classList.remove("visible");
                        searchInput.focus();
                        renderShowTitleSuggestions(suggestionsBox, showsData.filter(s =>
                            Array.isArray(s.genre) && s.genre.some(g => g.toLowerCase() === suggestionText.toLowerCase())
                        ).map(s => s.title));
                    }
                }
                selectedIndex = -1;
            });

            searchInput.addEventListener("keydown", (e) => {
                const suggestions = suggestionsBox.querySelectorAll(".suggestion-item");
                if (suggestions.length === 0) return;

                if (e.key === "ArrowDown") {
                    e.preventDefault();
                    selectedIndex = (selectedIndex + 1) % suggestions.length;
                    highlightSelectedSuggestion(suggestions, selectedIndex);
                } else if (e.key === "ArrowUp") {
                    e.preventDefault();
                    selectedIndex = (selectedIndex - 1 + suggestions.length) % suggestions.length;
                    highlightSelectedSuggestion(suggestions, selectedIndex);
                } else if (e.key === "Enter") {
                    e.preventDefault();
                    if (selectedIndex !== -1) {
                        suggestions[selectedIndex].click();
                    }
                }
            });

            function highlightSelectedSuggestion(suggestions, index) {
                suggestions.forEach((div, i) => {
                    if (i === index) {
                        div.classList.add("selected");
                        div.scrollIntoView({ block: "nearest", inline: "nearest" });
                    } else {
                        div.classList.remove("selected");
                    }
                });
            }

            document.addEventListener("click", (event) => {
                if (!searchSubheader.contains(event.target) && event.target !== searchIcon) {
                    searchSubheader.classList.remove("visible");
                    suggestionsBox.classList.remove("visible");
                    searchInput.value = "";
                    searchScope = null;
                    selectedIndex = -1;
                }
                if (!accountDropdown.contains(event.target) && event.target !== accountIcon) {
                    accountDropdown.classList.remove("visible");
                }
            });

            accountIcon.addEventListener("click", () => {
                accountDropdown.classList.toggle("visible");
                updateAccountDropdown(userLoggedIn);
            });

            darkModeToggle.addEventListener("click", () => {
                toggleDarkMode();
            });

            addIcon.addEventListener('click', (event) => {
                event.preventDefault();
                if (userLoggedIn) {
                    showMessageBox("Redirecting to settings for watchlist management (simulated)...", "fas fa-info-circle blue-icon");
                } else {
                    showMessageBox("You must be logged in to add shows to your playlist!", "fas fa-exclamation-triangle red-icon");
                }
            });

            hamburgerMenu.addEventListener('click', () => {
                mobileNavOverlay.classList.add('show');
            });

            mobileNavOverlay.addEventListener('click', (event) => {
                if (event.target === mobileNavOverlay || event.target.tagName === 'A') {
                    mobileNavOverlay.classList.remove('show');
                }
            });
            document.getElementById('closeMobileNav').addEventListener('click', () => {
                mobileNavOverlay.classList.remove('show');
            });
        }

        // --- Cinema Guide Page Initialization ---
        const citySelect = document.getElementById('citySelect');
        citySelect.addEventListener('change', (event) => {
            renderCinemaHalls(event.target.value);
        });

        // Initial render of cinema halls (default to 'all' cities)
        renderCinemaHalls('all');


        // Initial update of account dropdown state
        const storedTheme = localStorage.getItem('theme');
        if (storedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.classList.replace('fa-moon', 'fa-sun');
                darkModeToggle.setAttribute('title', 'Toggle Light Mode');
            }
        }
        updateAccountDropdown(false);

        // Update the current year in the footer
        const currentYearSpan = document.getElementById('current-year');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // Last Modified Date (footer)
        const lastModifiedSpan = document.getElementById('last-modified');
        if (lastModifiedSpan) {
            lastModifiedSpan.textContent = new Date(document.lastModified).toLocaleDateString();
        } else {
            console.warn("Last Modified span not found.");
        }
    });
  </script>
</body>
</html>
